<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Island Task, Operation & Location Log - Login</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Bootstrap for modals -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary-color: #34a853;
            --warning-color: #fbbc05;
            --danger-color: #ea4335;
            --info-color: #17a2b8;
            --text-color: #333;
            --text-light: #666;
            --bg-color: #f0f2f5;
            --card-bg: white;
            --border-color: #ddd;
            --sidebar-bg: #1e293b;
            --sidebar-text: #e2e8f0;
            --sidebar-hover: #334155;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --sidebar-width: 250px;
            --vehicle-color: #8e44ad;
            --shop-color: #e67e22;
            --boat-color: #3498db;
            --monitoring-color: #e74c3c;
            --dashboard-color: #9b59b6;
            --cctv-color: #9c27b0;
        }
        
        .dark-mode {
            --primary-color: #3b82f6;
            --primary-dark: #1d4ed8;
            --secondary-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #06b6d4;
            --text-color: #e2e8f0;
            --text-light: #94a3b8;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --border-color: #334155;
            --sidebar-bg: #0f172a;
            --sidebar-text: #cbd5e1;
            --sidebar-hover: #334155;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --vehicle-color: #a855f7;
            --shop-color: #f97316;
            --boat-color: #0ea5e9;
            --monitoring-color: #f87171;
            --dashboard-color: #a855f7;
            --cctv-color: #d946ef;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition);
            min-height: 100vh;
        }
        
        /* Login Container */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 40px;
            width: 100%;
            max-width: 450px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .login-header p {
            color: var(--text-light);
            font-size: 0.95rem;
        }
        
        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
        }
        
        .live-time {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: var(--transition);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .password-input {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .btn {
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn-full {
            width: 100%;
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-vehicle {
            background-color: var(--vehicle-color);
        }
        
        .btn-shop {
            background-color: var(--shop-color);
        }
        
        .btn-boat {
            background-color: var(--boat-color);
        }
        
        .btn-cctv {
            background-color: var(--cctv-color);
        }
        
        .btn-dashboard {
            background-color: var(--dashboard-color);
        }
        
        .btn-sm {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .dark-mode-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
            cursor: pointer;
            background-color: var(--bg-color);
            border-radius: 20px;
            transition: var(--transition);
        }
        
        .dark-mode-toggle:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .login-footer {
            text-align: center;
            margin-top: 25px;
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .login-footer .developer {
            color: var(--primary-color);
            font-weight: 600;
            margin-top: 5px;
        }
        
        /* Dashboard Styles (Initially Hidden) */
        .dashboard {
            display: none;
        }
        
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            display: flex;
            flex-direction: column;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            transform: translateX(0);
        }
        
        .sidebar.collapsed {
            transform: translateX(-100%);
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .sidebar-header h2 {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 5px;
        }
        
        .sidebar-header p {
            font-size: 0.8rem;
            color: var(--sidebar-text);
            opacity: 0.8;
        }
        
        .user-info {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .user-details {
            flex: 1;
        }
        
        .user-name {
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .user-role {
            color: var(--sidebar-text);
            font-size: 0.8rem;
            margin-top: 2px;
        }
        
        .nav-menu {
            flex: 1;
            padding: 20px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: var(--sidebar-text);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
            cursor: pointer;
        }
        
        .nav-item:hover {
            background-color: var(--sidebar-hover);
            color: white;
            padding-left: 25px;
        }
        
        .nav-item.active {
            background-color: rgba(59, 130, 246, 0.2);
            border-left: 3px solid var(--primary-color);
            color: white;
        }
        
        .nav-item.vehicle {
            border-left-color: var(--vehicle-color);
        }
        
        .nav-item.shop {
            border-left-color: var(--shop-color);
        }
        
        .nav-item.boat {
            border-left-color: var(--boat-color);
        }
        
        .nav-item.monitoring {
            border-left-color: var(--monitoring-color);
        }
        
        .nav-item.cctv {
            border-left-color: var(--cctv-color);
        }
        
        .nav-item.dashboard {
            border-left-color: var(--dashboard-color);
        }
        
        .nav-item i {
            margin-right: 12px;
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }
        
        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            font-size: 0.9rem;
            color: var(--sidebar-text);
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .sidebar-overlay.active {
            display: block;
            opacity: 1;
        }
        
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
            transition: margin-left 0.4s cubic-bezier(0.4, 0, 0.2, 1), padding 0.3s ease;
            width: calc(100% - var(--sidebar-width));
        }
        
        .sidebar.collapsed + .main-content {
            margin-left: 0;
            width: 100%;
        }
        
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header-left h1 {
            font-size: 1.8rem;
            color: var(--primary-color);
        }
        
        .header-left p {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .hamburger-menu {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
            background: var(--card-bg);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }
        
        .hamburger-menu:hover {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }
        
        .tab-content {
            display: none;
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .language-tabs {
            display: flex;
            margin-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .language-tab {
            padding: 8px 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-light);
            transition: var(--transition);
        }
        
        .language-tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }
        
        .message-container {
            display: none;
        }
        
        .message-container.active {
            display: block;
        }
        
        .dhivehi-text {
            font-family: 'Faruma', 'Noto Sans Arabic', 'MV Typewriter', 'Mv Waheed', 'Mv Iyyu Nala', sans-serif;
            direction: rtl;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .dhivehi-input {
            font-family: 'Faruma', 'Noto Sans Arabic', 'MV Typewriter', 'Mv Waheed', 'Mv Iyyu Nala', sans-serif;
            direction: rtl;
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: right;
        }
        
        select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: var(--transition);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .filter-section {
            margin: 20px 0;
            padding: 15px;
            background-color: var(--bg-color);
            border-radius: 8px;
        }
        
        .filter-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text-light);
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .log-container {
            margin-top: 20px;
        }
        
        .log-item {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            position: relative;
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .log-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .timestamp {
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .log-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .copy-btn {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .edit-btn {
            background-color: var(--warning-color);
            color: white;
        }
        
        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--border-color);
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            color: var(--text-light);
        }
        
        /* Dashboard Statistics */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-top: 4px solid var(--primary-color);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card.vehicle {
            border-top-color: var(--vehicle-color);
        }
        
        .stat-card.shop {
            border-top-color: var(--shop-color);
        }
        
        .stat-card.boat {
            border-top-color: var(--boat-color);
        }
        
        .stat-card.monitoring {
            border-top-color: var(--monitoring-color);
        }
        
        .stat-card.cctv {
            border-top-color: var(--cctv-color);
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 500;
        }
        
        .stat-change {
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .positive-change {
            color: var(--secondary-color);
        }
        
        .negative-change {
            color: var(--danger-color);
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 25px 15px;
            background-color: var(--card-bg);
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: var(--primary-color);
        }
        
        .quick-action-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .quick-action-label {
            font-weight: 600;
            color: var(--text-color);
            font-size: 1.1rem;
        }
        
        .quick-action-desc {
            color: var(--text-light);
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        /* Admin Panel Styles */
        .admin-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .users-table th,
        .users-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .users-table th {
            background-color: var(--bg-color);
            font-weight: 600;
            color: var(--text-color);
        }
        
        .user-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-active {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--secondary-color);
        }
        
        .status-inactive {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--danger-color);
        }
        
        .action-icons {
            display: flex;
            gap: 10px;
        }
        
        .action-icon {
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
            font-size: 1.1rem;
        }
        
        .action-icon:hover {
            color: var(--primary-color);
        }
        
        .logout-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .logout-btn:hover {
            background-color: #d32f2f;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeInModal 0.3s ease;
        }
        
        @keyframes fadeInModal {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background-color: var(--card-bg);
            width: 90%;
            max-width: 800px;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            animation: slideInModal 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes slideInModal {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
        }
        
        .close-btn:hover {
            color: var(--danger-color);
            transform: scale(1.1);
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--card-bg);
            color: var(--text-color);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            display: none;
            border-left: 4px solid var(--primary-color);
            animation: slideInToast 0.3s ease;
        }
        
        @keyframes slideInToast {
            from { transform: translateX(-50%) translateY(20px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        .main-footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: var(--text-light);
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        
        /* Edit/Delete modal styles */
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        .data-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
        }
        
        .edit-data-btn, .delete-data-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .edit-data-btn {
            background-color: var(--warning-color);
            color: white;
        }
        
        .delete-data-btn {
            background-color: var(--danger-color);
            color: white;
        }
        
        .edit-data-btn:hover, .delete-data-btn:hover {
            transform: scale(1.1);
        }
        
        /* Admin-only styles */
        .admin-only {
            display: none !important;
        }
        
        .admin-only.show {
            display: flex !important;
        }
        
        /* Fix for tab content */
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.show {
            display: block;
        }
        
        /* Separate Copy Styles */
        .separate-copy-section {
            margin: 15px 0;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.02);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .copy-title {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .copy-item {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            position: relative;
            transition: var(--transition);
        }
        
        .copy-item:hover {
            border-color: var(--primary-color);
            background-color: rgba(59, 130, 246, 0.05);
        }
        
        .copy-content {
            padding-right: 40px;
            word-break: break-word;
            line-height: 1.6;
        }
        
        .copy-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--secondary-color);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }
        
        .copy-icon:hover {
            background-color: var(--primary-color);
            transform: scale(1.1);
        }
        
        .copy-icon i {
            font-size: 0.9rem;
        }
        
        .message-type {
            font-size: 0.8rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .location-name-item {
            border-left: 3px solid var(--secondary-color);
        }
        
        .remarks-item {
            border-left: 3px solid var(--warning-color);
        }
        
        .english-message-item {
            border-left: 3px solid var(--primary-color);
        }
        
        .dhivehi-message-item {
            border-left: 3px solid #8e44ad;
        }
        
        .empty-message {
            color: var(--text-light);
            font-style: italic;
            padding: 8px;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.02);
            border-radius: 4px;
        }
        
        /* New Styles for Vehicles, Shops, Boats, and Monitoring */
        .entry-form {
            background-color: var(--bg-color);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid var(--primary-color);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .form-row .form-group {
            flex: 1;
            min-width: 200px;
            margin-bottom: 0;
        }
        
        .table-container {
            background-color: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background-color: var(--bg-color);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-color);
            border-bottom: 2px solid var(--border-color);
        }
        
        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }
        
        .data-table tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }
        
        .data-table .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-normal {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--secondary-color);
        }
        
        .status-issue {
            background-color: rgba(251, 188, 5, 0.1);
            color: var(--warning-color);
        }
        
        .status-critical {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--danger-color);
        }
        
        .table-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .mark-btn {
            padding: 5px 10px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .mark-traffic {
            background-color: rgba(251, 188, 5, 0.1);
            color: var(--warning-color);
            border: 1px solid var(--warning-color);
        }
        
        .mark-issue {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }
        
        .mark-other {
            background-color: rgba(108, 117, 125, 0.1);
            color: #6c757d;
            border: 1px solid #6c757d;
        }
        
        .mark-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .monitoring-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--monitoring-color);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .monitoring-item {
            border-left: 4px solid var(--monitoring-color) !important;
        }
        
        .issue-note {
            margin-top: 5px;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.02);
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .vehicle-color {
            color: var(--vehicle-color);
        }
        
        .shop-color {
            color: var(--shop-color);
        }
        
        .boat-color {
            color: var(--boat-color);
        }
        
        .cctv-color {
            color: var(--cctv-color);
        }
        
        .monitoring-color {
            color: var(--monitoring-color);
        }
        
        .dashboard-color {
            color: var(--dashboard-color);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .section-header h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
        }
        
        .section-header p {
            color: var(--text-light);
            font-size: 1rem;
        }
        
        .clear-filter-btn {
            background-color: transparent;
            color: var(--text-light);
            border: 1px solid var(--border-color);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .clear-filter-btn:hover {
            background-color: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
        }
        
        /* Image Upload Styles */
        .image-preview-container {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 15px;
        }
        
        .image-preview-container:hover {
            border-color: var(--primary-color);
            background-color: rgba(0, 0, 0, 0.02);
        }
        
        .image-preview {
            width: 100%;
            height: 200px;
            margin: 10px auto;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            background-color: var(--bg-color);
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .plus-sign {
            font-size: 48px;
            color: var(--text-light);
        }
        
        .vehicle-image-small, .shop-image-small, .boat-image-small, .cctv-image-small {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .vehicle-image-small:hover, .shop-image-small:hover, .boat-image-small:hover, .cctv-image-small:hover {
            transform: scale(3);
            z-index: 100;
            position: relative;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            background-color: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        
        .input-group-text {
            padding: 10px 15px;
            background-color: var(--bg-color);
            color: var(--text-light);
            border: none;
        }
        
        .form-control {
            flex: 1;
            padding: 10px 15px;
            border: none;
            background: transparent;
            color: var(--text-color);
        }
        
        .form-control:focus {
            outline: none;
        }
        
        .action-buttons {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .owner-contact-cell {
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .table-responsive {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .modal-image {
            max-width: 100%;
            max-height: 80vh;
        }
        
        .export-btn {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Island filter pills */
        .island-filter-pills {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .island-pill {
            padding: 8px 15px;
            background-color: var(--bg-color);
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
        }
        
        .island-pill:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .island-pill.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Recent activity */
        .recent-activity {
            margin-top: 30px;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .activity-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
        }
        
        .activity-icon.vehicle {
            background-color: var(--vehicle-color);
        }
        
        .activity-icon.shop {
            background-color: var(--shop-color);
        }
        
        .activity-icon.boat {
            background-color: var(--boat-color);
        }
        
        .activity-icon.cctv {
            background-color: var(--cctv-color);
        }
        
        .activity-icon.task {
            background-color: var(--primary-color);
        }
        
        .activity-details {
            flex: 1;
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 5px;
        }
        
        /* Dropdown Menu Styles for CCTV */
        .dropdown-container {
            display: none;
            background-color: rgba(0, 0, 0, 0.1);
            padding-left: 20px;
        }
        
        .dropdown-container.show {
            display: block;
        }
        
        .dropdown-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .dropdown-icon {
            transition: transform 0.3s;
        }
        
        .dropdown-btn.active .dropdown-icon {
            transform: rotate(180deg);
        }
        
        .dropdown-link {
            padding: 12px 20px 12px 40px !important;
            font-size: 0.9rem;
        }
        
        .dropdown-link:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .quick-add-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--cctv-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1.2rem;
        }
        
        .quick-add-btn:hover {
            background-color: var(--primary-color);
            transform: scale(1.1);
        }
        
        /* Mobile Responsive */
        @media (max-width: 1200px) {
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 15px;
            }
            
            .hamburger-menu {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .users-table, .data-table {
                display: block;
                overflow-x: auto;
            }
            
            .data-actions {
                position: static;
                justify-content: flex-start;
                margin-top: 10px;
            }
            
            .log-actions {
                flex-wrap: wrap;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .form-row .form-group {
                min-width: 100%;
            }
            
            .search-box .input-group {
                width: 100%;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        
        @media (max-width: 768px) {
            .login-card {
                padding: 30px 20px;
            }
            
            .filter-group {
                flex-direction: column;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .log-actions, .table-actions {
                flex-wrap: wrap;
            }
            
            .admin-controls {
                flex-direction: column;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .modal-actions .btn {
                width: 100%;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .image-preview {
                height: 150px;
            }
        }
        
        @media (max-width: 480px) {
            .login-card {
                padding: 20px 15px;
            }
            
            .login-header h1 {
                font-size: 1.5rem;
            }
            
            .main-header h1 {
                font-size: 1.5rem;
            }
            
            .section-header h2 {
                font-size: 1.5rem;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
        }
    </style>
    
    <!-- Dhivehi Font -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Faruma';
            src: local('Faruma'), 
                 url('https://cdn.jsdelivr.net/gh/aaishath/faruma@main/faruma.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-island-tropical"></i>
                </div>
                <h1>F. Atoll Island Log System</h1>
                <p>Official Login - Restricted Access</p>
            </div>
            
            <div class="live-time" id="login-time">
                Loading time...
            </div>
            
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Enter your username">
            </div>
            
            <div class="form-group">
                <label for="password">Password</label>
                <div class="password-input">
                    <input type="password" id="password" placeholder="Enter your password">
                    <button type="button" class="toggle-password" id="toggle-password">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <button class="btn btn-full" id="login-btn">
                <i class="fas fa-sign-in-alt"></i> Sign In
            </button>
            
            <div class="dark-mode-toggle" id="login-dark-mode-toggle">
                <i class="fas fa-moon"></i>
                <span>Dark Mode</span>
            </div>
            
            <div class="login-footer">
                <p>Faafu Atoll Police Department</p>
                <p class="developer">System Version 9.1 | Developed by Ahmed Vaseem</p>
                <p style="margin-top: 10px; font-size: 0.8rem; color: var(--warning-color);">
                    <i class="fas fa-exclamation-circle"></i> For authorized personnel only
                </p>
            </div>
        </div>
    </div>
    
    <!-- Dashboard (Initially Hidden) -->
    <div class="dashboard" id="dashboard">
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Island Log System</h2>
                <p>Faafu Atoll</p>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">AV</div>
                <div class="user-details">
                    <div class="user-name" id="sidebar-username">Loading...</div>
                    <div class="user-role" id="sidebar-role">Administrator</div>
                </div>
            </div>
            
            <div class="nav-menu">
                <a href="#" class="nav-item dashboard active" data-tab="dashboard-tab">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-tab="task-log">
                    <i class="fas fa-tasks"></i>
                    <span>Task Log</span>
                </a>
                <a href="#" class="nav-item" data-tab="operation-log">
                    <i class="fas fa-search"></i>
                    <span>Operation Log</span>
                </a>
                <a href="#" class="nav-item" data-tab="location-log">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Location Log</span>
                </a>
                <a href="#" class="nav-item vehicle" data-tab="vehicles">
                    <i class="fas fa-car"></i>
                    <span>Vehicles</span>
                </a>
                <a href="#" class="nav-item shop" data-tab="shops">
                    <i class="fas fa-store"></i>
                    <span>Shops</span>
                </a>
                <a href="#" class="nav-item boat" data-tab="boats">
                    <i class="fas fa-ship"></i>
                    <span>Boats/Dinghy</span>
                </a>
                <a href="#" class="nav-item cctv" id="cctv-dropdown-btn">
                    <i class="fas fa-video"></i>
                    <span>CCTV Areas</span>
                    <i class="fas fa-chevron-down dropdown-icon" style="margin-left: auto; font-size: 0.8rem;"></i>
                </a>
                <div class="dropdown-container" id="cctv-dropdown">
                    <a href="#" class="nav-item dropdown-link" data-tab="cctv-areas" data-island="F.Feeali">
                        <i class="fas fa-island-tropical"></i>
                        <span>F.Feeali</span>
                    </a>
                    <a href="#" class="nav-item dropdown-link" data-tab="cctv-areas" data-island="F.Bilehdhoo">
                        <i class="fas fa-island-tropical"></i>
                        <span>F.Bilehdhoo</span>
                    </a>
                    <a href="#" class="nav-item dropdown-link" data-tab="cctv-areas" data-island="F.Dharaboodhoo">
                        <i class="fas fa-island-tropical"></i>
                        <span>F.Dharaboodhoo</span>
                    </a>
                    <a href="#" class="nav-item dropdown-link" data-tab="cctv-areas" data-island="F.Magoodhoo">
                        <i class="fas fa-island-tropical"></i>
                        <span>F.Magoodhoo</span>
                    </a>
                    <a href="#" class="nav-item dropdown-link" data-tab="cctv-areas" data-island="F.Nilandhoo">
                        <i class="fas fa-island-tropical"></i>
                        <span>F.Nilandhoo</span>
                    </a>
                    <a href="#" class="nav-item dropdown-link" data-tab="cctv-areas" data-island="">
                        <i class="fas fa-globe"></i>
                        <span>All Islands</span>
                    </a>
                </div>
                <button class="quick-add-btn" id="quick-add-cctv" title="Quick Add CCTV">
                    <i class="fas fa-plus"></i>
                </button>
                <a href="#" class="nav-item monitoring" data-tab="monitoring">
                    <i class="fas fa-eye"></i>
                    <span>Monitoring</span>
                </a>
                <a href="#" class="nav-item admin-only" data-tab="admin-panel" id="admin-tab">
                    <i class="fas fa-user-shield"></i>
                    <span>Admin Panel</span>
                </a>
                <a href="#" class="nav-item" id="dashboard-dark-mode-toggle">
                    <i class="fas fa-moon"></i>
                    <span>Dark Mode</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <p>Logged in as: <span id="footer-username">Loading...</span></p>
                <p id="sidebar-time">Loading time...</p>
                <button class="logout-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="main-header">
                <div class="header-left">
                    <h1>F. Atoll Island Management System</h1>
                    <p>Welcome, <span id="header-username">Loading...</span> | <span id="dashboard-time">Loading time...</span></p>
                </div>
                
                <div class="header-right">
                    <div class="hamburger-menu" id="hamburger-menu">
                        <i class="fas fa-bars"></i>
                    </div>
                </div>
            </div>
            
            <!-- Tab Contents -->
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-tachometer-alt dashboard-color"></i> Dashboard Overview</h2>
                        <p>Complete statistics and quick access to all features</p>
                    </div>
                    <div>
                        <button id="refresh-dashboard" class="btn btn-sm">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <!-- Island Filter Pills -->
                <div class="island-filter-pills" id="dashboard-island-pills">
                    <div class="island-pill active" data-island="">All Islands</div>
                    <div class="island-pill" data-island="F.Feeali">F.Feeali</div>
                    <div class="island-pill" data-island="F.Bilehdhoo">F.Bilehdhoo</div>
                    <div class="island-pill" data-island="F.Dharaboodhoo">F.Dharaboodhoo</div>
                    <div class="island-pill" data-island="F.Magoodhoo">F.Magoodhoo</div>
                    <div class="island-pill" data-island="F.Nilandhoo">F.Nilandhoo</div>
                </div>
                
                <!-- Statistics Cards -->
                <div class="dashboard-stats" id="dashboard-stats">
                    <!-- Statistics will be loaded here -->
                </div>
                
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <div class="quick-action-btn" data-tab="task-log">
                        <div class="quick-action-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="quick-action-label">Task Log</div>
                        <div class="quick-action-desc">Add or view tasks</div>
                    </div>
                    
                    <div class="quick-action-btn" data-tab="vehicles">
                        <div class="quick-action-icon">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="quick-action-label">Vehicles</div>
                        <div class="quick-action-desc">Register vehicles</div>
                    </div>
                    
                    <div class="quick-action-btn" data-tab="shops">
                        <div class="quick-action-icon">
                            <i class="fas fa-store"></i>
                        </div>
                        <div class="quick-action-label">Shops</div>
                        <div class="quick-action-desc">Manage shops</div>
                    </div>
                    
                    <div class="quick-action-btn" data-tab="boats">
                        <div class="quick-action-icon">
                            <i class="fas fa-ship"></i>
                        </div>
                        <div class="quick-action-label">Boats/Dinghy</div>
                        <div class="quick-action-desc">Register vessels</div>
                    </div>
                    
                    <div class="quick-action-btn" data-tab="cctv-areas">
                        <div class="quick-action-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="quick-action-label">CCTV Areas</div>
                        <div class="quick-action-desc">Manage cameras</div>
                    </div>
                    
                    <div class="quick-action-btn" data-tab="operation-log">
                        <div class="quick-action-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="quick-action-label">Operations</div>
                        <div class="quick-action-desc">Log operations</div>
                    </div>
                    
                    <div class="quick-action-btn" data-tab="monitoring">
                        <div class="quick-action-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="quick-action-label">Monitoring</div>
                        <div class="quick-action-desc">View flagged items</div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="recent-activity">
                    <h3><i class="fas fa-history"></i> Recent Activity</h3>
                    <div id="recent-activity-list">
                        <!-- Recent activity will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Task Log Tab - MODIFIED: Forms hidden by default -->
            <div id="task-log" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-tasks"></i> Task Log Management</h2>
                        <p>Record and manage daily tasks for each island</p>
                    </div>
                    <div>
                        <button id="toggle-task-form" class="btn btn-secondary">
                            <i class="fas fa-plus"></i> Add New Task
                        </button>
                        <button id="export-task-pdf" class="btn btn-secondary export-btn">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                    </div>
                </div>
                
                <!-- Task Entry Form (Initially Hidden) -->
                <div id="task-entry-form" class="entry-form" style="display: none;">
                    <h3><i class="fas fa-plus-circle"></i> Add New Task</h3>
                    <div class="form-group">
                        <label for="task-island-select">Select Island</label>
                        <select id="task-island-select">
                            <option value="">-- Select an island --</option>
                            <option value="F.Feeali">F.Feeali</option>
                            <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                            <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                            <option value="F.Magoodhoo">F.Magoodhoo</option>
                            <option value="F.Nilandhoo">F.Nilandhoo</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="task-service-number">Officer Service Number</label>
                        <input type="text" id="task-service-number" placeholder="Enter officer service number">
                    </div>
                    
                    <div class="form-group">
                        <label>Task Message</label>
                        <div class="language-tabs">
                            <button type="button" class="language-tab active" data-lang="en">English</button>
                            <button type="button" class="language-tab" data-lang="dv">Dhivehi</button>
                        </div>
                        <div id="task-message-en" class="message-container active">
                            <textarea id="task-message-en-input" placeholder="Enter task message in English..."></textarea>
                        </div>
                        <div id="task-message-dv" class="message-container">
                            <textarea id="task-message-dv-input" class="dhivehi-input" placeholder="  ..."></textarea>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <button id="save-task" class="btn btn-secondary">
                            <i class="fas fa-save"></i> Save Task
                        </button>
                        <button id="cancel-task-form" class="btn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
                
                <div class="filter-section">
                    <div class="filter-group">
                        <select id="task-filter-island" class="filter-select">
                            <option value="">All Islands</option>
                            <option value="F.Feeali">F.Feeali</option>
                            <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                            <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                            <option value="F.Magoodhoo">F.Magoodhoo</option>
                            <option value="F.Nilandhoo">F.Nilandhoo</option>
                        </select>
                        <input type="text" id="task-search" class="form-control" placeholder="Search tasks...">
                    </div>
                    <div class="stats">
                        <span id="task-total-count">Total Tasks: 0</span>
                        <span id="task-filtered-count">Filtered: 0</span>
                        <button id="clear-task-filter" class="clear-filter-btn">Clear Filters</button>
                    </div>
                </div>
                
                <div class="log-container" id="task-log-container">
                    <div class="loading">Loading task logs...</div>
                </div>
            </div>
            
            <!-- Operation Log Tab - MODIFIED: Forms hidden by default -->
            <div id="operation-log" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-search"></i> Operation Log Management</h2>
                        <p>Record and track operational activities</p>
                    </div>
                    <div>
                        <button id="toggle-operation-form" class="btn btn-secondary">
                            <i class="fas fa-plus"></i> Add New Operation
                        </button>
                        <button id="export-operation-pdf" class="btn btn-secondary export-btn">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                    </div>
                </div>
                
                <!-- Operation Entry Form (Initially Hidden) -->
                <div id="operation-entry-form" class="entry-form" style="display: none;">
                    <h3><i class="fas fa-plus-circle"></i> Add New Operation</h3>
                    <div class="form-group">
                        <label for="operation-island-select">Select Island</label>
                        <select id="operation-island-select">
                            <option value="">-- Select an island --</option>
                            <option value="F.Feeali">F.Feeali</option>
                            <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                            <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                            <option value="F.Magoodhoo">F.Magoodhoo</option>
                            <option value="F.Nilandhoo">F.Nilandhoo</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="operation-service-number">Officer Service Number</label>
                        <input type="text" id="operation-service-number" placeholder="Enter officer service number">
                    </div>
                    
                    <div class="form-group">
                        <label>Operation Message</label>
                        <div class="language-tabs">
                            <button type="button" class="language-tab active" data-lang="en">English</button>
                            <button type="button" class="language-tab" data-lang="dv">Dhivehi</button>
                        </div>
                        <div id="operation-message-en" class="message-container active">
                            <textarea id="operation-message-en-input" placeholder="Enter operation message in English..."></textarea>
                        </div>
                        <div id="operation-message-dv" class="message-container">
                            <textarea id="operation-message-dv-input" class="dhivehi-input" placeholder="  ..."></textarea>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <button id="save-operation" class="btn btn-secondary">
                            <i class="fas fa-save"></i> Save Operation
                        </button>
                        <button id="cancel-operation-form" class="btn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
                
                <div class="filter-section">
                    <div class="filter-group">
                        <select id="operation-filter-island" class="filter-select">
                            <option value="">All Islands</option>
                            <option value="F.Feeali">F.Feeali</option>
                            <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                            <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                            <option value="F.Magoodhoo">F.Magoodhoo</option>
                            <option value="F.Nilandhoo">F.Nilandhoo</option>
                        </select>
                        <input type="text" id="operation-search" class="form-control" placeholder="Search operations...">
                    </div>
                    <div class="stats">
                        <span id="operation-total-count">Total Operations: 0</span>
                        <span id="operation-filtered-count">Filtered: 0</span>
                        <button id="clear-operation-filter" class="clear-filter-btn">Clear Filters</button>
                    </div>
                </div>
                
                <div class="log-container" id="operation-log-container">
                    <div class="loading">Loading operation logs...</div>
                </div>
            </div>
            
            <!-- Location Log Tab - MODIFIED: Forms hidden by default -->
            <div id="location-log" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-map-marker-alt"></i> Location Log Management</h2>
                        <p>Track and manage island locations</p>
                    </div>
                    <div>
                        <button id="toggle-location-form" class="btn btn-secondary">
                            <i class="fas fa-plus"></i> Add New Location
                        </button>
                        <button id="export-location-pdf" class="btn btn-secondary export-btn">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                    </div>
                </div>
                
                <!-- Location Entry Form (Initially Hidden) -->
                <div id="location-entry-form" class="entry-form" style="display: none;">
                    <h3><i class="fas fa-plus-circle"></i> Add New Location</h3>
                    <div class="form-group">
                        <label for="location-island-select">Select Island</label>
                        <select id="location-island-select">
                            <option value="">-- Select an island --</option>
                            <option value="F.Feeali">F.Feeali</option>
                            <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                            <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                            <option value="F.Magoodhoo">F.Magoodhoo</option>
                            <option value="F.Nilandhoo">F.Nilandhoo</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="location-name">Location Name</label>
                        <input type="text" id="location-name" placeholder="Enter location name (e.g., Police Station, Harbor, Health Center)">
                    </div>
                    
                    <div class="form-group">
                        <label for="location-remarks">Remarks Message</label>
                        <textarea id="location-remarks" placeholder="Enter remarks about this location..."></textarea>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <button id="save-location" class="btn btn-secondary">
                            <i class="fas fa-save"></i> Save Location
                        </button>
                        <button id="cancel-location-form" class="btn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
                
                <div class="filter-section">
                    <div class="filter-group">
                        <select id="location-filter-island" class="filter-select">
                            <option value="">All Islands</option>
                            <option value="F.Feeali">F.Feeali</option>
                            <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                            <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                            <option value="F.Magoodhoo">F.Magoodhoo</option>
                            <option value="F.Nilandhoo">F.Nilandhoo</option>
                        </select>
                        <input type="text" id="location-search" class="form-control" placeholder="Search locations...">
                    </div>
                    <div class="stats">
                        <span id="location-total-count">Total Locations: 0</span>
                        <span id="location-filtered-count">Filtered: 0</span>
                        <button id="clear-location-filter" class="clear-filter-btn">Clear Filters</button>
                    </div>
                </div>
                
                <div class="log-container" id="location-log-container">
                    <div class="loading">Loading location logs...</div>
                </div>
            </div>
            
            <!-- Vehicles Tab with Images -->
            <div id="vehicles" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-car vehicle-color"></i> Vehicle Management</h2>
                        <p>Register and manage island vehicles with images</p>
                    </div>
                    <button id="toggle-vehicle-form" class="btn btn-vehicle">
                        <i class="fas fa-plus-circle"></i> Add New Vehicle
                    </button>
                </div>
                
                <!-- Vehicle Entry Form -->
                <div id="vehicle-entry-form" class="entry-form" style="display: none;">
                    <h3><i class="fas fa-plus-circle"></i> Register New Vehicle</h3>
                    <form id="vehicleForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vehicle-island">Select Island</label>
                                <select id="vehicle-island" required>
                                    <option value="">-- Select island --</option>
                                    <option value="F.Feeali">F.Feeali</option>
                                    <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                                    <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                                    <option value="F.Magoodhoo">F.Magoodhoo</option>
                                    <option value="F.Nilandhoo">F.Nilandhoo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="vehicle-type">Vehicle Type</label>
                                <select id="vehicle-type" required>
                                    <option value="">-- Select type --</option>
                                    <option value="Car">Car</option>
                                    <option value="Motorcycle">Motorcycle</option>
                                    <option value="Van">Van</option>
                                    <option value="Pickup Truck">Pickup Truck</option>
                                    <option value="Truck">Truck</option>
                                    <option value="Bus">Bus</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vehicle-legal-owner">Legal Owner</label>
                                <input type="text" id="vehicle-legal-owner" required placeholder="Enter legal owner name">
                            </div>
                            <div class="form-group">
                                <label for="vehicle-beneficial-owner">Beneficial Owner</label>
                                <input type="text" id="vehicle-beneficial-owner" required placeholder="Enter beneficial owner name">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vehicle-number">Vehicle Number</label>
                                <input type="text" id="vehicle-number" required placeholder="e.g., A-1234">
                            </div>
                            <div class="form-group">
                                <label for="vehicle-owner-contact">Owner Contact</label>
                                <input type="text" id="vehicle-owner-contact" required placeholder="e.g., 1234567">
                            </div>
                        </div>
                        
                        <!-- Image Upload Section -->
                        <div class="form-group">
                            <label>Upload Vehicle Image</label>
                            <div class="image-preview-container" id="vehicle-image-preview-container">
                                <div id="vehicle-image-preview" class="image-preview">
                                    <span class="plus-sign">+</span>
                                </div>
                                <input type="file" id="vehicle-image-upload" accept="image/*" class="d-none" required>
                            </div>
                            <small class="text-muted">Click the area above to upload a vehicle image (required)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="vehicle-notes">Additional Notes</label>
                            <textarea id="vehicle-notes" placeholder="Any additional information about the vehicle..." rows="2"></textarea>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-vehicle">
                                <i class="fas fa-save"></i> Register Vehicle
                            </button>
                            <button type="button" id="cancel-vehicle-form" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Action Buttons and Search -->
                <div class="action-buttons">
                    <div class="search-box">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" id="vehicle-search" class="form-control" placeholder="Search by Vehicle Number, Owner, or Island...">
                        </div>
                    </div>
                    <button id="export-vehicles-pdf" class="btn btn-danger export-btn">
                        <i class="fas fa-file-pdf"></i> Export to PDF
                    </button>
                </div>
                
                <div class="filter-section">
                    <div class="filter-group">
                        <select id="vehicle-filter-island" class="filter-select">
                            <option value="">All Islands</option>
                            <option value="F.Feeali">F.Feeali</option>
                            <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                            <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                            <option value="F.Magoodhoo">F.Magoodhoo</option>
                            <option value="F.Nilandhoo">F.Nilandhoo</option>
                        </select>
                        <select id="vehicle-filter-type" class="filter-select">
                            <option value="">All Types</option>
                            <option value="Car">Car</option>
                            <option value="Motorcycle">Motorcycle</option>
                            <option value="Van">Van</option>
                            <option value="Pickup Truck">Pickup Truck</option>
                            <option value="Truck">Truck</option>
                            <option value="Bus">Bus</option>
                            <option value="Other">Other</option>
                        </select>
                        <select id="vehicle-filter-status" class="filter-select">
                            <option value="">All Status</option>
                            <option value="normal">Normal</option>
                            <option value="traffic_issue">Traffic Violation</option>
                            <option value="other_issue">Other Issue</option>
                        </select>
                    </div>
                    <div class="stats">
                        <span id="vehicle-total-count">Total Vehicles: 0</span>
                        <span id="vehicle-filtered-count">Filtered: 0</span>
                        <button id="clear-vehicle-filter" class="clear-filter-btn">Clear Filters</button>
                    </div>
                </div>
                
                <!-- Vehicles Table -->
                <div class="table-container">
                    <div class="table-responsive">
                        <table class="data-table" id="vehicles-table">
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Island</th>
                                    <th>Vehicle Type</th>
                                    <th>Vehicle No.</th>
                                    <th>Legal Owner</th>
                                    <th>Beneficial Owner</th>
                                    <th>Owner Contact</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vehicles-table-body">
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 30px;">Loading vehicles...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Shops Tab with Images - MODIFIED: Added CCTV column -->
            <div id="shops" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-store shop-color"></i> Shop Management</h2>
                        <p>Register and manage island shops with images and CCTV status</p>
                    </div>
                    <button id="toggle-shop-form" class="btn btn-shop">
                        <i class="fas fa-plus-circle"></i> Add New Shop
                    </button>
                </div>
                
                <!-- Shop Entry Form - MODIFIED: Added CCTV checkbox -->
                <div id="shop-entry-form" class="entry-form" style="display: none;">
                    <h3><i class="fas fa-plus-circle"></i> Register New Shop</h3>
                    <form id="shopForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="shop-island">Select Island</label>
                                <select id="shop-island" required>
                                    <option value="">-- Select island --</option>
                                    <option value="F.Feeali">F.Feeali</option>
                                    <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                                    <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                                    <option value="F.Magoodhoo">F.Magoodhoo</option>
                                    <option value="F.Nilandhoo">F.Nilandhoo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="shop-name">Shop Name</label>
                                <input type="text" id="shop-name" required placeholder="e.g., Island Supermarket">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="shop-owner">Owner Name</label>
                                <input type="text" id="shop-owner" required placeholder="Enter owner full name">
                            </div>
                            <div class="form-group">
                                <label for="shop-owner-id">Owner ID Number</label>
                                <input type="text" id="shop-owner-id" required placeholder="ID card number">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="shop-contact">Contact Number</label>
                                <input type="text" id="shop-contact" required placeholder="e.g., 1234567">
                            </div>
                            <div class="form-group">
                                <label for="shop-location">Shop Location</label>
                                <input type="text" id="shop-location" placeholder="e.g., Main Street (optional)">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="shop-description">Shop Description / Type</label>
                            <select id="shop-description" required>
                                <option value="">-- Select type --</option>
                                <option value="Supermarket">Supermarket</option>
                                <option value="Cafe/Restaurant">Cafe/Restaurant</option>
                                <option value="Electronics">Electronics Store</option>
                                <option value="Clothing">Clothing Store</option>
                                <option value="Hardware">Hardware Store</option>
                                <option value="Pharmacy">Pharmacy</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <!-- CCTV Checkbox -->
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="shop-cctv-available">
                                <i class="fas fa-video"></i> CCTV Available at this shop
                            </label>
                        </div>
                        
                        <!-- Image Upload Section -->
                        <div class="form-group">
                            <label>Upload Shop Image</label>
                            <div class="image-preview-container" id="shop-image-preview-container">
                                <div id="shop-image-preview" class="image-preview">
                                    <span class="plus-sign">+</span>
                                </div>
                                <input type="file" id="shop-image-upload" accept="image/*" class="d-none" required>
                            </div>
                            <small class="text-muted">Click the area above to upload a shop image (required)</small>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-shop">
                                <i class="fas fa-save"></i> Register Shop
                            </button>
                            <button type="button" id="cancel-shop-form" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Action Buttons and Search -->
                <div class="action-buttons">
                    <div class="search-box">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" id="shop-search" class="form-control" placeholder="Search by Shop Name, Owner, or Island...">
                        </div>
                    </div>
                    <button id="export-shops-pdf" class="btn btn-danger export-btn">
                        <i class="fas fa-file-pdf"></i> Export to PDF
                    </button>
                </div>
                
                <div class="filter-section">
                    <div class="filter-group">
                        <select id="shop-filter-island" class="filter-select">
                            <option value="">All Islands</option>
                            <option value="F.Feeali">F.Feeali</option>
                            <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                            <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                            <option value="F.Magoodhoo">F.Magoodhoo</option>
                            <option value="F.Nilandhoo">F.Nilandhoo</option>
                        </select>
                        <select id="shop-filter-type" class="filter-select">
                            <option value="">All Types</option>
                            <option value="Supermarket">Supermarket</option>
                            <option value="Cafe/Restaurant">Cafe/Restaurant</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Clothing">Clothing</option>
                            <option value="Hardware">Hardware</option>
                            <option value="Pharmacy">Pharmacy</option>
                            <option value="Other">Other</option>
                        </select>
                        <select id="shop-filter-cctv" class="filter-select">
                            <option value="">CCTV: All</option>
                            <option value="yes">CCTV: Available</option>
                            <option value="no">CCTV: Not Available</option>
                        </select>
                    </div>
                    <div class="stats">
                        <span id="shop-total-count">Total Shops: 0</span>
                        <span id="shop-filtered-count">Filtered: 0</span>
                        <button id="clear-shop-filter" class="clear-filter-btn">Clear Filters</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <div id="shop-table-container">
                        <table class="data-table" id="shops-table">
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Island</th>
                                    <th>Shop Name</th>
                                    <th>Owner Name</th>
                                    <th>Contact</th>
                                    <th>Type</th>
                                    <th>CCTV</th>
                                    <th>Location</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="shops-table-body">
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 30px;">Loading shops...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Boats/Dinghy Tab with Images -->
            <div id="boats" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-ship boat-color"></i> Boat & Dinghy Management</h2>
                        <p>Register and manage island vessels with images</p>
                    </div>
                    <button id="toggle-boat-form" class="btn btn-boat">
                        <i class="fas fa-plus-circle"></i> Add New Vessel
                    </button>
                </div>
                
                <!-- Boat Entry Form -->
                <div id="boat-entry-form" class="entry-form" style="display: none;">
                    <h3><i class="fas fa-plus-circle"></i> Register New Vessel</h3>
                    <form id="boatForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="boat-island">Select Island</label>
                                <select id="boat-island" required>
                                    <option value="">-- Select island --</option>
                                    <option value="F.Feeali">F.Feeali</option>
                                    <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                                    <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                                    <option value="F.Magoodhoo">F.Magoodhoo</option>
                                    <option value="F.Nilandhoo">F.Nilandhoo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="boat-type">Vessel Type</label>
                                <select id="boat-type" required>
                                    <option value="">-- Select type --</option>
                                    <option value="Speedboat">Speedboat</option>
                                    <option value="Fishing Boat">Fishing Boat</option>
                                    <option value="Dinghy">Dinghy</option>
                                    <option value="Cargo Boat">Cargo Boat</option>
                                    <option value="Passenger Ferry">Passenger Ferry</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="boat-name">Vessel Name</label>
                                <input type="text" id="boat-name" required placeholder="e.g., Island Voyager">
                            </div>
                            <div class="form-group">
                                <label for="boat-owner">Owner Name</label>
                                <input type="text" id="boat-owner" required placeholder="Enter owner full name">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="boat-owner-id">Owner ID Number</label>
                                <input type="text" id="boat-owner-id" required placeholder="ID card number">
                            </div>
                            <div class="form-group">
                                <label for="boat-contact">Contact Number</label>
                                <input type="text" id="boat-contact" required placeholder="e.g., 1234567">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="boat-reg-number">Registration Number</label>
                                <input type="text" id="boat-reg-number" required placeholder="Vessel registration number">
                            </div>
                            <div class="form-group">
                                <label for="boat-capacity">Capacity (Persons)</label>
                                <input type="number" id="boat-capacity" required placeholder="e.g., 10" min="1">
                            </div>
                        </div>
                        
                        <!-- Image Upload Section -->
                        <div class="form-group">
                            <label>Upload Vessel Image</label>
                            <div class="image-preview-container" id="boat-image-preview-container">
                                <div id="boat-image-preview" class="image-preview">
                                    <span class="plus-sign">+</span>
                                </div>
                                <input type="file" id="boat-image-upload" accept="image/*" class="d-none" required>
                            </div>
                            <small class="text-muted">Click the area above to upload a vessel image (required)</small>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-boat">
                                <i class="fas fa-save"></i> Register Vessel
                            </button>
                            <button type="button" id="cancel-boat-form" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Action Buttons and Search -->
                <div class="action-buttons">
                    <div class="search-box">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" id="boat-search" class="form-control" placeholder="Search by Vessel Name, Owner, or Island...">
                        </div>
                    </div>
                    <button id="export-boats-pdf" class="btn btn-danger export-btn">
                        <i class="fas fa-file-pdf"></i> Export to PDF
                    </button>
                </div>
                
                <div class="filter-section">
                    <div class="filter-group">
                        <select id="boat-filter-island" class="filter-select">
                            <option value="">All Islands</option>
                            <option value="F.Feeali">F.Feeali</option>
                            <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                            <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                            <option value="F.Magoodhoo">F.Magoodhoo</option>
                            <option value="F.Nilandhoo">F.Nilandhoo</option>
                        </select>
                        <select id="boat-filter-type" class="filter-select">
                            <option value="">All Types</option>
                            <option value="Speedboat">Speedboat</option>
                            <option value="Fishing Boat">Fishing Boat</option>
                            <option value="Dinghy">Dinghy</option>
                            <option value="Cargo Boat">Cargo Boat</option>
                            <option value="Passenger Ferry">Passenger Ferry</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="stats">
                        <span id="boat-total-count">Total Vessels: 0</span>
                        <span id="boat-filtered-count">Filtered: 0</span>
                        <button id="clear-boat-filter" class="clear-filter-btn">Clear Filters</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <div id="boat-table-container">
                        <table class="data-table" id="boats-table">
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Island</th>
                                    <th>Vessel Type</th>
                                    <th>Vessel Name</th>
                                    <th>Owner Name</th>
                                    <th>Contact</th>
                                    <th>Reg. Number</th>
                                    <th>Capacity</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="boats-table-body">
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 30px;">Loading vessels...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- NEW: CCTV Areas Tab -->
            <div id="cctv-areas" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-video cctv-color"></i> CCTV Areas Management</h2>
                        <p>Register and manage CCTV camera locations across islands</p>
                    </div>
                    <button id="toggle-cctv-form" class="btn btn-cctv">
                        <i class="fas fa-plus-circle"></i> Add New CCTV Camera
                    </button>
                </div>
                
                <!-- CCTV Entry Form -->
                <div id="cctv-entry-form" class="entry-form" style="display: none;">
                    <h3><i class="fas fa-plus-circle"></i> Register New CCTV Camera</h3>
                    <form id="cctvForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cctv-island">Select Island</label>
                                <select id="cctv-island" required>
                                    <option value="">-- Select island --</option>
                                    <option value="F.Feeali">F.Feeali</option>
                                    <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                                    <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                                    <option value="F.Magoodhoo">F.Magoodhoo</option>
                                    <option value="F.Nilandhoo">F.Nilandhoo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cctv-location-type">Location Type</label>
                                <select id="cctv-location-type" required>
                                    <option value="">-- Select location type --</option>
                                    <option value="House">House</option>
                                    <option value="Road">Road</option>
                                    <option value="Shop">Shop</option>
                                    <option value="Gov Office">Government Office</option>
                                    <option value="Pvt Office">Private Office</option>
                                    <option value="Harbor">Harbor</option>
                                    <option value="School">School</option>
                                    <option value="Health Center">Health Center</option>
                                    <option value="Mosque">Mosque</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cctv-location-name">Location Name / Address</label>
                                <input type="text" id="cctv-location-name" required placeholder="e.g., Main Street, Island Supermarket, Police Station">
                            </div>
                            <div class="form-group">
                                <label for="cctv-area-name">CCTV Area Name (Optional)</label>
                                <input type="text" id="cctv-area-name" placeholder="e.g., Entrance Camera, Parking Area, Main Gate">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cctv-installation-date">Installation Date</label>
                                <input type="date" id="cctv-installation-date">
                            </div>
                            <div class="form-group">
                                <label for="cctv-status">Camera Status</label>
                                <select id="cctv-status" required>
                                    <option value="active" selected>Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="maintenance">Under Maintenance</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="cctv-notes">Additional Notes</label>
                            <textarea id="cctv-notes" placeholder="Any additional information about the CCTV camera..." rows="2"></textarea>
                        </div>
                        
                        <!-- Image Upload Section -->
                        <div class="form-group">
                            <label>Upload CCTV Location Image</label>
                            <div class="image-preview-container" id="cctv-image-preview-container">
                                <div id="cctv-image-preview" class="image-preview">
                                    <span class="plus-sign">+</span>
                                </div>
                                <input type="file" id="cctv-image-upload" accept="image/*" class="d-none" required>
                            </div>
                            <small class="text-muted">Click the area above to upload an image of the CCTV location (required)</small>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-cctv">
                                <i class="fas fa-save"></i> Register CCTV Camera
                            </button>
                            <button type="button" id="cancel-cctv-form" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Action Buttons and Search -->
                <div class="action-buttons">
                    <div class="search-box">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" id="cctv-search" class="form-control" placeholder="Search by Location, Area Name, or Island...">
                        </div>
                    </div>
                    <button id="export-cctv-pdf" class="btn btn-danger export-btn">
                        <i class="fas fa-file-pdf"></i> Export to PDF
                    </button>
                </div>
                
                <div class="filter-section">
                    <div class="filter-group">
                        <select id="cctv-filter-island" class="filter-select">
                            <option value="">All Islands</option>
                            <option value="F.Feeali">F.Feeali</option>
                            <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                            <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                            <option value="F.Magoodhoo">F.Magoodhoo</option>
                            <option value="F.Nilandhoo">F.Nilandhoo</option>
                        </select>
                        <select id="cctv-filter-location-type" class="filter-select">
                            <option value="">All Location Types</option>
                            <option value="House">House</option>
                            <option value="Road">Road</option>
                            <option value="Shop">Shop</option>
                            <option value="Gov Office">Government Office</option>
                            <option value="Pvt Office">Private Office</option>
                            <option value="Harbor">Harbor</option>
                            <option value="School">School</option>
                            <option value="Health Center">Health Center</option>
                            <option value="Mosque">Mosque</option>
                            <option value="Other">Other</option>
                        </select>
                        <select id="cctv-filter-status" class="filter-select">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="maintenance">Under Maintenance</option>
                        </select>
                    </div>
                    <div class="stats">
                        <span id="cctv-total-count">Total CCTV Cameras: 0</span>
                        <span id="cctv-filtered-count">Filtered: 0</span>
                        <button id="clear-cctv-filter" class="clear-filter-btn">Clear Filters</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <div id="cctv-table-container">
                        <table class="data-table" id="cctv-table">
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Island</th>
                                    <th>Location Type</th>
                                    <th>Location Name</th>
                                    <th>Area Name</th>
                                    <th>Installation Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="cctv-table-body">
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 30px;">Loading CCTV cameras...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Monitoring Tab -->
            <div id="monitoring" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-eye monitoring-color"></i> Monitoring Dashboard</h2>
                        <p>Track items marked for monitoring (including vehicles, shops, and boats with images)</p>
                    </div>
                    <div class="stats">
                        <span id="monitoring-total-count">Total Items: 0</span>
                        <button id="export-monitoring-pdf" class="btn btn-danger export-btn">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                        <button id="refresh-monitoring" class="btn btn-sm">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <div class="filter-section">
                    <div class="filter-group">
                        <select id="monitoring-filter-type" class="filter-select">
                            <option value="">All Types</option>
                            <option value="vehicle">Vehicles</option>
                            <option value="shop">Shops</option>
                            <option value="boat">Boats/Dinghy</option>
                            <option value="cctv">CCTV Cameras</option>
                        </select>
                        <select id="monitoring-filter-status" class="filter-select">
                            <option value="">All Issues</option>
                            <option value="traffic_issue">Traffic Violations</option>
                            <option value="other_issue">Other Issues</option>
                        </select>
                        <select id="monitoring-filter-island" class="filter-select">
                            <option value="">All Islands</option>
                            <option value="F.Feeali">F.Feeali</option>
                            <option value="F.Bilehdhoo">F.Bilehdhoo</option>
                            <option value="F.Dharaboodhoo">F.Dharaboodhoo</option>
                            <option value="F.Magoodhoo">F.Magoodhoo</option>
                            <option value="F.Nilandhoo">F.Nilandhoo</option>
                        </select>
                    </div>
                    <div class="stats">
                        <button id="clear-monitoring-filter" class="clear-filter-btn">Clear All Filters</button>
                    </div>
                </div>
                
                <div class="log-container" id="monitoring-container">
                    <div class="loading">Loading monitoring items...</div>
                </div>
            </div>
            
            <!-- Admin Panel (Only visible to av_5637) -->
            <div id="admin-panel" class="tab-content admin-tab-content">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-user-shield"></i> Admin Panel - User Management</h2>
                        <p>Manage user access and monitor system activity</p>
                    </div>
                    <button id="export-users-pdf" class="btn btn-secondary export-btn">
                        <i class="fas fa-file-pdf"></i> Export Users PDF
                    </button>
                </div>
                
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="total-users">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-value" id="active-users">0</div>
                        <div class="stat-label">Active Users</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-slash"></i>
                        </div>
                        <div class="stat-value" id="inactive-users">0</div>
                        <div class="stat-label">Inactive Users</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <div class="stat-value" id="today-logins">0</div>
                        <div class="stat-label">Today's Logins</div>
                    </div>
                </div>
                
                <div class="admin-controls">
                    <button class="btn btn-secondary" id="add-user-btn">
                        <i class="fas fa-user-plus"></i> Add New User
                    </button>
                    <button class="btn btn-warning" id="refresh-users-btn">
                        <i class="fas fa-sync-alt"></i> Refresh List
                    </button>
                </div>
                
                <p class="admin-note" style="color: var(--warning-color); margin-bottom: 15px; font-size: 0.9rem;">
                    <i class="fas fa-exclamation-triangle"></i> Only av_5637 can access and manage users
                </p>
                
                <div class="table-container">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Full Name</th>
                                <th>Role</th>
                                <th>Last Login</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <tr>
                                <td colspan="6" style="text-align: center;">Loading users...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Footer -->
            <footer class="main-footer">
                <p>Faafu Atoll Island Log System &copy; <span id="current-year"></span></p>
                <p class="developer">Developed by: Ahmed Vaseem</p>
                <p>For official use only | Version 9.1</p>
            </footer>
        </div>
    </div>
    
    <!-- Add User Modal -->
    <div id="add-user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New User</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="form-group">
                <label for="new-username">Username</label>
                <input type="text" id="new-username" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label for="new-password">Password</label>
                <input type="password" id="new-password" placeholder="Enter password">
            </div>
            <div class="form-group">
                <label for="new-fullname">Full Name</label>
                <input type="text" id="new-fullname" placeholder="Enter full name">
            </div>
            <div class="form-group">
                <label for="new-role">Role</label>
                                <select id="new-role">
                    <option value="admin">Administrator</option>
                    <option value="user" selected>Regular User</option>
                    <option value="viewer">Viewer (Read Only)</option>
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="new-user-active" checked> Active Account
                </label>
            </div>
            <div class="modal-actions">
                <button id="save-new-user" class="btn btn-secondary">Save User</button>
                <button class="btn close-modal-btn">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Data Modal -->
    <div id="edit-data-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="edit-modal-title">Edit Data</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div id="edit-modal-content">
                <!-- Dynamic content will be loaded here -->
            </div>
            <div class="modal-actions">
                <button id="save-edit" class="btn btn-secondary">Save Changes</button>
                <button class="btn close-modal-btn">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Confirm Delete</h2>
                <button class="close-btn">&times;</button>
            </div>
            <p id="delete-message">Are you sure you want to delete this item?</p>
            <div class="modal-actions">
                <button id="confirm-delete" class="btn btn-danger">Delete</button>
                <button class="btn close-modal-btn">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Image Preview Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalTitle">Image Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modalImage" src="" class="modal-image" alt="Image Preview">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDLFVvp9cgV3TkERps8tRozpexUXyrwNA4",
            authDomain: "faafu-atoll-statistics.firebaseapp.com",
            databaseURL: "https://faafu-atoll-statistics-default-rtdb.firebaseio.com",
            projectId: "faafu-atoll-statistics",
            storageBucket: "faafu-atoll-statistics.firebasestorage.app",
            messagingSenderId: "280399317384",
            appId: "1:280399317384:web:ac6f9b826471077e7a123d",
            measurementId: "G-VH5GX7C6QC"
        };

        // Initialize Firebase
        let app, database, auth;
        try {
            app = firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            auth = firebase.auth();
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        // Global variables
        let currentUser = null;
        let isAdmin = false;
        let timeInterval;
        let selectedIsland = ''; // For dashboard filtering
        let cctvItems = []; // For CCTV data
        
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            init();
        });

        // Initialize the application
        function init() {
            console.log("Initializing application...");
            
            // Set current year
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // Update time every second
            updateTime();
            timeInterval = setInterval(updateTime, 1000);
            
            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                updateDarkModeToggle(true);
            }
            
            // Set up event listeners
            setupEventListeners();
            
            // Check if user is already logged in
            checkExistingSession();
            
            console.log("Application initialized");
        }
        
        // Set up all event listeners
        function setupEventListeners() {
            // Login events
            document.getElementById('toggle-password').addEventListener('click', togglePasswordVisibility);
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            document.getElementById('login-dark-mode-toggle').addEventListener('click', toggleDarkMode);
            
            // Dashboard events
            document.getElementById('dashboard-dark-mode-toggle').addEventListener('click', toggleDarkMode);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            document.getElementById('hamburger-menu').addEventListener('click', toggleSidebar);
            document.getElementById('sidebar-overlay').addEventListener('click', closeSidebarMobile);
            
            // Navigation events
            setupNavigation();
            
            // Admin events
            document.getElementById('add-user-btn').addEventListener('click', showAddUserModal);
            document.getElementById('refresh-users-btn').addEventListener('click', loadUsers);
            document.getElementById('save-new-user').addEventListener('click', saveNewUser);
            document.getElementById('refresh-dashboard').addEventListener('click', loadDashboardData);
            
            // Modal events
            setupModalEvents();
            
            // Quick action buttons
            setupQuickActions();
            
            // Island filter pills
            setupIslandFilters();
            
            // Form submissions
            setupFormSubmissions();
            
            // Search and filter events
            setupSearchFilters();
            
            // Export buttons
            setupExportButtons();
            
            // Task/Operation/Location form toggle buttons
            setupFormToggleButtons();
            
            // CCTV dropdown
            document.getElementById('cctv-dropdown-btn').addEventListener('click', toggleCCTVDropdown);
            document.getElementById('quick-add-cctv').addEventListener('click', quickAddCCTV);
            
            // Check mobile on load and resize
            checkMobile();
            window.addEventListener('resize', checkMobile);
        }
        
        // Setup navigation
        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    
                    // Handle dark mode toggle separately
                    if (this.id === 'dashboard-dark-mode-toggle') {
                        toggleDarkMode();
                        return;
                    }
                    
                    // Handle CCTV dropdown links
                    if (this.classList.contains('dropdown-link')) {
                        const island = this.getAttribute('data-island');
                        if (island) {
                            document.getElementById('cctv-filter-island').value = island;
                        } else {
                            document.getElementById('cctv-filter-island').value = '';
                        }
                        // Close dropdown on mobile
                        if (window.innerWidth <= 992) {
                            toggleCCTVDropdown();
                        }
                    }
                    
                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    // Don't set active class for dropdown links
                    if (!this.classList.contains('dropdown-link')) {
                        this.classList.add('active');
                    }
                    
                    // Hide all tab contents
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    
                    // Handle admin panel access
                    if (tabId === 'admin-panel') {
                        if (!isAdmin) {
                            showToast('Admin access required');
                            // Switch to dashboard instead
                            document.querySelector('.nav-item[data-tab="dashboard-tab"]').click();
                            return;
                        }
                        document.getElementById(tabId).classList.add('active');
                    } else {
                        document.getElementById(tabId).classList.add('active');
                    }
                    
                    // Load data for specific tabs
                    switch(tabId) {
                        case 'dashboard-tab':
                            loadDashboardData();
                            break;
                        case 'task-log':
                            loadTaskLogs();
                            break;
                        case 'operation-log':
                            loadOperationLogs();
                            break;
                        case 'location-log':
                            loadLocationLogs();
                            break;
                        case 'vehicles':
                            loadVehicles();
                            break;
                        case 'shops':
                            loadShops();
                            break;
                        case 'boats':
                            loadBoats();
                            break;
                        case 'cctv-areas':
                            loadCCTVItems();
                            break;
                        case 'monitoring':
                            loadMonitoringItems();
                            break;
                        case 'admin-panel':
                            loadUsers();
                            break;
                    }
                    
                    closeSidebarMobile();
                });
            });
        }
        
        // Setup modal events
        function setupModalEvents() {
            const closeModalBtns = document.querySelectorAll('.close-btn, .close-modal-btn');
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) hideModal(modal);
                });
            });
            
            document.getElementById('save-edit').addEventListener('click', saveEdit);
            document.getElementById('confirm-delete').addEventListener('click', confirmDelete);
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    hideModal(e.target);
                }
            });
        }
        
        // Setup quick action buttons
        function setupQuickActions() {
            document.querySelectorAll('.quick-action-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    document.querySelector(`.nav-item[data-tab="${tabId}"]`).click();
                });
            });
        }
        
        // Setup island filter pills
        function setupIslandFilters() {
            document.querySelectorAll('.island-pill').forEach(pill => {
                pill.addEventListener('click', function() {
                    document.querySelectorAll('.island-pill').forEach(p => p.classList.remove('active'));
                    this.classList.add('active');
                    selectedIsland = this.getAttribute('data-island');
                    loadDashboardData();
                });
            });
        }
        
        // Setup form submissions
        function setupFormSubmissions() {
            // Task form
            document.getElementById('save-task').addEventListener('click', saveTask);
            
            // Operation form
            document.getElementById('save-operation').addEventListener('click', saveOperation);
            
            // Location form
            document.getElementById('save-location').addEventListener('click', saveLocation);
            
            // Vehicle form
            document.getElementById('toggle-vehicle-form').addEventListener('click', () => {
                toggleForm('vehicle');
            });
            document.getElementById('cancel-vehicle-form').addEventListener('click', () => {
                toggleForm('vehicle', false);
            });
            document.getElementById('vehicleForm').addEventListener('submit', (e) => {
                e.preventDefault();
                saveVehicle();
            });
            
            // Shop form
            document.getElementById('toggle-shop-form').addEventListener('click', () => {
                toggleForm('shop');
            });
            document.getElementById('cancel-shop-form').addEventListener('click', () => {
                toggleForm('shop', false);
            });
            document.getElementById('shopForm').addEventListener('submit', (e) => {
                e.preventDefault();
                saveShop();
            });
            
            // Boat form
            document.getElementById('toggle-boat-form').addEventListener('click', () => {
                toggleForm('boat');
            });
            document.getElementById('cancel-boat-form').addEventListener('click', () => {
                toggleForm('boat', false);
            });
            document.getElementById('boatForm').addEventListener('submit', (e) => {
                e.preventDefault();
                saveBoat();
            });
            
            // CCTV form
            document.getElementById('toggle-cctv-form').addEventListener('click', () => {
                toggleForm('cctv');
            });
            document.getElementById('cancel-cctv-form').addEventListener('click', () => {
                toggleForm('cctv', false);
            });
            document.getElementById('cctvForm').addEventListener('submit', (e) => {
                e.preventDefault();
                saveCCTV();
            });
            
            // Image upload handlers
            setupImageUploads();
        }
        
        // Setup form toggle buttons for Task, Operation, Location
        function setupFormToggleButtons() {
            // Task form toggle
            document.getElementById('toggle-task-form').addEventListener('click', () => {
                const form = document.getElementById('task-entry-form');
                form.style.display = form.style.display === 'none' ? 'block' : 'none';
            });
            document.getElementById('cancel-task-form').addEventListener('click', () => {
                document.getElementById('task-entry-form').style.display = 'none';
            });
            
            // Operation form toggle
            document.getElementById('toggle-operation-form').addEventListener('click', () => {
                const form = document.getElementById('operation-entry-form');
                form.style.display = form.style.display === 'none' ? 'block' : 'none';
            });
            document.getElementById('cancel-operation-form').addEventListener('click', () => {
                document.getElementById('operation-entry-form').style.display = 'none';
            });
            
            // Location form toggle
            document.getElementById('toggle-location-form').addEventListener('click', () => {
                const form = document.getElementById('location-entry-form');
                form.style.display = form.style.display === 'none' ? 'block' : 'none';
            });
            document.getElementById('cancel-location-form').addEventListener('click', () => {
                document.getElementById('location-entry-form').style.display = 'none';
            });
        }
        
        // Setup image uploads
        function setupImageUploads() {
            // Vehicle image
            const vehicleImageContainer = document.getElementById('vehicle-image-preview-container');
            const vehicleImageUpload = document.getElementById('vehicle-image-upload');
            vehicleImageContainer.addEventListener('click', () => vehicleImageUpload.click());
            vehicleImageUpload.addEventListener('change', (e) => handleImageUpload(e, 'vehicle'));
            
            // Shop image
            const shopImageContainer = document.getElementById('shop-image-preview-container');
            const shopImageUpload = document.getElementById('shop-image-upload');
            shopImageContainer.addEventListener('click', () => shopImageUpload.click());
            shopImageUpload.addEventListener('change', (e) => handleImageUpload(e, 'shop'));
            
            // Boat image
            const boatImageContainer = document.getElementById('boat-image-preview-container');
            const boatImageUpload = document.getElementById('boat-image-upload');
            boatImageContainer.addEventListener('click', () => boatImageUpload.click());
            boatImageUpload.addEventListener('change', (e) => handleImageUpload(e, 'boat'));
            
            // CCTV image
            const cctvImageContainer = document.getElementById('cctv-image-preview-container');
            const cctvImageUpload = document.getElementById('cctv-image-upload');
            cctvImageContainer.addEventListener('click', () => cctvImageUpload.click());
            cctvImageUpload.addEventListener('change', (e) => handleImageUpload(e, 'cctv'));
        }
        
        // Setup search and filter events
        function setupSearchFilters() {
            // Task filters
            document.getElementById('task-filter-island').addEventListener('change', renderTaskLogs);
            document.getElementById('task-search').addEventListener('input', renderTaskLogs);
            document.getElementById('clear-task-filter').addEventListener('click', () => {
                document.getElementById('task-filter-island').value = '';
                document.getElementById('task-search').value = '';
                renderTaskLogs();
            });
            
            // Operation filters
            document.getElementById('operation-filter-island').addEventListener('change', renderOperationLogs);
            document.getElementById('operation-search').addEventListener('input', renderOperationLogs);
            document.getElementById('clear-operation-filter').addEventListener('click', () => {
                document.getElementById('operation-filter-island').value = '';
                document.getElementById('operation-search').value = '';
                renderOperationLogs();
            });
            
            // Location filters
            document.getElementById('location-filter-island').addEventListener('change', renderLocationLogs);
            document.getElementById('location-search').addEventListener('input', renderLocationLogs);
            document.getElementById('clear-location-filter').addEventListener('click', () => {
                document.getElementById('location-filter-island').value = '';
                document.getElementById('location-search').value = '';
                renderLocationLogs();
            });
            
            // Vehicle filters
            document.getElementById('vehicle-filter-island').addEventListener('change', renderVehiclesTable);
            document.getElementById('vehicle-filter-type').addEventListener('change', renderVehiclesTable);
            document.getElementById('vehicle-filter-status').addEventListener('change', renderVehiclesTable);
            document.getElementById('vehicle-search').addEventListener('input', renderVehiclesTable);
            document.getElementById('clear-vehicle-filter').addEventListener('click', () => {
                document.getElementById('vehicle-filter-island').value = '';
                document.getElementById('vehicle-filter-type').value = '';
                document.getElementById('vehicle-filter-status').value = '';
                document.getElementById('vehicle-search').value = '';
                renderVehiclesTable();
            });
            
            // Shop filters
            document.getElementById('shop-filter-island').addEventListener('change', renderShopsTable);
            document.getElementById('shop-filter-type').addEventListener('change', renderShopsTable);
            document.getElementById('shop-filter-cctv').addEventListener('change', renderShopsTable);
            document.getElementById('shop-search').addEventListener('input', renderShopsTable);
            document.getElementById('clear-shop-filter').addEventListener('click', () => {
                document.getElementById('shop-filter-island').value = '';
                document.getElementById('shop-filter-type').value = '';
                document.getElementById('shop-filter-cctv').value = '';
                document.getElementById('shop-search').value = '';
                renderShopsTable();
            });
            
            // Boat filters
            document.getElementById('boat-filter-island').addEventListener('change', renderBoatsTable);
            document.getElementById('boat-filter-type').addEventListener('change', renderBoatsTable);
            document.getElementById('boat-search').addEventListener('input', renderBoatsTable);
            document.getElementById('clear-boat-filter').addEventListener('click', () => {
                document.getElementById('boat-filter-island').value = '';
                document.getElementById('boat-filter-type').value = '';
                document.getElementById('boat-search').value = '';
                renderBoatsTable();
            });
            
            // CCTV filters
            document.getElementById('cctv-filter-island').addEventListener('change', renderCCTVTable);
            document.getElementById('cctv-filter-location-type').addEventListener('change', renderCCTVTable);
            document.getElementById('cctv-filter-status').addEventListener('change', renderCCTVTable);
            document.getElementById('cctv-search').addEventListener('input', renderCCTVTable);
            document.getElementById('clear-cctv-filter').addEventListener('click', () => {
                document.getElementById('cctv-filter-island').value = '';
                document.getElementById('cctv-filter-location-type').value = '';
                document.getElementById('cctv-filter-status').value = '';
                document.getElementById('cctv-search').value = '';
                renderCCTVTable();
            });
            
            // Monitoring filters
            document.getElementById('monitoring-filter-type').addEventListener('change', renderMonitoringItems);
            document.getElementById('monitoring-filter-status').addEventListener('change', renderMonitoringItems);
            document.getElementById('monitoring-filter-island').addEventListener('change', renderMonitoringItems);
            document.getElementById('clear-monitoring-filter').addEventListener('click', () => {
                document.getElementById('monitoring-filter-type').value = '';
                document.getElementById('monitoring-filter-status').value = '';
                document.getElementById('monitoring-filter-island').value = '';
                renderMonitoringItems();
            });
        }
        
        // Setup export buttons
        function setupExportButtons() {
            document.getElementById('export-task-pdf').addEventListener('click', () => exportToPDF('task'));
            document.getElementById('export-operation-pdf').addEventListener('click', () => exportToPDF('operation'));
            document.getElementById('export-location-pdf').addEventListener('click', () => exportToPDF('location'));
            document.getElementById('export-vehicles-pdf').addEventListener('click', () => exportToPDF('vehicle'));
            document.getElementById('export-shops-pdf').addEventListener('click', () => exportToPDF('shop'));
            document.getElementById('export-boats-pdf').addEventListener('click', () => exportToPDF('boat'));
            document.getElementById('export-cctv-pdf').addEventListener('click', () => exportToPDF('cctv'));
            document.getElementById('export-monitoring-pdf').addEventListener('click', () => exportToPDF('monitoring'));
            document.getElementById('export-users-pdf').addEventListener('click', () => exportToPDF('user'));
        }
        
        // Toggle CCTV dropdown[citation:3]
        function toggleCCTVDropdown() {
            const dropdown = document.getElementById('cctv-dropdown');
            const button = document.getElementById('cctv-dropdown-btn');
            dropdown.classList.toggle('show');
            button.classList.toggle('active');
        }
        
        // Quick add CCTV from sidebar
        function quickAddCCTV() {
            // Switch to CCTV tab
            document.querySelector('.nav-item[data-tab="cctv-areas"]').click();
            // Show the CCTV form
            toggleForm('cctv', true);
            // Close sidebar on mobile
            closeSidebarMobile();
        }
        
        // Toggle form visibility
        function toggleForm(type, show = null) {
            const form = document.getElementById(`${type}-entry-form`);
            if (show === null) {
                form.style.display = form.style.display === 'none' ? 'block' : 'none';
            } else {
                form.style.display = show ? 'block' : 'none';
            }
        }
        
        // Handle image upload[citation:7]
        function handleImageUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type[citation:2]
            if (!file.type.includes('image')) {
                showToast('Only image files are allowed');
                event.target.value = '';
                return;
            }
            
            // Validate file size (max 10MB)
            if (file.size > 10_000_000) {
                showToast('Maximum upload size is 10MB');
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            const preview = document.getElementById(`${type}-image-preview`);
            
            reader.onload = function(e) {
                preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
            };
            
            reader.readAsDataURL(file);
        }
        
        // Update time display
        function updateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const timeStr = now.toLocaleTimeString('en-US', {
                hour12: true,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const fullTime = `${dateStr} | ${timeStr}`;
            
            const loginTimeElement = document.getElementById('login-time');
            const sidebarTimeElement = document.getElementById('sidebar-time');
            const dashboardTimeElement = document.getElementById('dashboard-time');
            
            if (loginTimeElement) loginTimeElement.textContent = fullTime;
            if (sidebarTimeElement) sidebarTimeElement.textContent = fullTime;
            if (dashboardTimeElement) dashboardTimeElement.textContent = fullTime;
        }
        
        // Toggle password visibility
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const toggleBtn = document.getElementById('toggle-password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            toggleBtn.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
        }
        
        // Handle login
        async function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                showToast('Please enter username and password');
                return;
            }
            
            const loginBtn = document.getElementById('login-btn');
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
            loginBtn.disabled = true;
            
            try {
                const userRef = database.ref('users/' + username);
                const snapshot = await userRef.once('value');
                
                if (!snapshot.exists()) {
                    showToast('User not found');
                    resetLoginButton();
                    return;
                }
                
                const userData = snapshot.val();
                
                if (!userData.isActive) {
                    showToast('Account is deactivated. Contact administrator.');
                    resetLoginButton();
                    return;
                }
                
                if (userData.password !== password) {
                    showToast('Invalid password');
                    resetLoginButton();
                    return;
                }
                
                // Update last login
                await userRef.update({
                    lastLogin: new Date().toISOString()
                });
                
                // Login successful
                loginUser({
                    username: username,
                    fullName: userData.fullName,
                    role: userData.role
                });
                
            } catch (error) {
                console.error('Login error:', error);
                showToast('Login failed. Please try again.');
                resetLoginButton();
            }
        }
        
        // Reset login button
        function resetLoginButton() {
            const loginBtn = document.getElementById('login-btn');
            loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
            loginBtn.disabled = false;
        }
        
        // Login user
        function loginUser(user) {
            currentUser = user;
            isAdmin = user.username === 'av_5637';
            
            // Save to localStorage
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            // Update UI with user info
            updateUserInfo(user);
            
            // Switch to dashboard
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('dashboard').style.display = 'flex';
            
            // Load initial data
            loadDashboardData();
            loadTaskLogs();
            loadOperationLogs();
            loadLocationLogs();
            loadVehicles();
            loadShops();
            loadBoats();
            loadCCTVItems();
            loadMonitoringItems();
            
            // Show admin tab if admin
            if (isAdmin) {
                document.getElementById('admin-tab').classList.add('show');
                loadUsers();
            } else {
                document.getElementById('admin-tab').classList.remove('show');
            }
            
            // Show welcome message
            showToast(`Welcome, ${user.fullName}!`);
            
            // Reset login form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('password').type = 'password';
            document.getElementById('toggle-password').innerHTML = '<i class="fas fa-eye"></i>';
            resetLoginButton();
        }
        
        // Update user info in UI
        function updateUserInfo(user) {
            const initials = user.fullName.split(' ').map(n => n[0]).join('').toUpperCase();
            
            document.getElementById('user-avatar').textContent = initials;
            document.getElementById('sidebar-username').textContent = user.fullName;
            document.getElementById('sidebar-role').textContent = user.role.charAt(0).toUpperCase() + user.role.slice(1);
            document.getElementById('footer-username').textContent = user.username;
            document.getElementById('header-username').textContent = user.fullName;
        }
        
        // Handle logout
        function handleLogout() {
            if (currentUser) {
                currentUser = null;
                isAdmin = false;
                localStorage.removeItem('currentUser');
            }
            
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('login-container').style.display = 'flex';
            
            showToast('Logged out successfully');
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            updateDarkModeToggle(isDarkMode);
            localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
            showToast(isDarkMode ? 'Dark mode enabled' : 'Light mode enabled');
        }
        
        // Update dark mode toggle button
        function updateDarkModeToggle(isDarkMode) {
            const icon = isDarkMode ? 'sun' : 'moon';
            const text = isDarkMode ? 'Light Mode' : 'Dark Mode';
            
            const loginToggle = document.getElementById('login-dark-mode-toggle');
            const dashboardToggle = document.getElementById('dashboard-dark-mode-toggle');
            
            if (loginToggle) {
                loginToggle.innerHTML = `<i class="fas fa-${icon}"></i><span>${text}</span>`;
            }
            
            if (dashboardToggle) {
                dashboardToggle.innerHTML = `<i class="fas fa-${icon}"></i><span>${text}</span>`;
            }
        }
        
        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const isMobile = window.innerWidth <= 992;
            
            if (isMobile) {
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
            }
        }
        
        // Close sidebar on mobile
        function closeSidebarMobile() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const isMobile = window.innerWidth <= 992;
            
            if (isMobile) {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            }
        }
        
        // Check if mobile
        function checkMobile() {
            const isMobile = window.innerWidth <= 992;
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            if (isMobile) {
                sidebar.classList.add('collapsed');
            } else {
                sidebar.classList.remove('collapsed');
                overlay.classList.remove('active');
            }
        }
        
        // Show toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        // Show modal
        function showModal(modal) {
            modal.style.display = 'flex';
        }
        
        // Hide modal
        function hideModal(modal) {
            modal.style.display = 'none';
        }
        
        // Show add user modal
        function showAddUserModal() {
            if (!isAdmin) {
                showToast('Admin access required');
                return;
            }
            showModal(document.getElementById('add-user-modal'));
        }
        
        // Check existing session
        function checkExistingSession() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    const user = JSON.parse(savedUser);
                    database.ref('users/' + user.username).once('value')
                        .then(snapshot => {
                            if (snapshot.exists()) {
                                const userData = snapshot.val();
                                if (userData.isActive) {
                                    loginUser(user);
                                } else {
                                    localStorage.removeItem('currentUser');
                                    showToast('Your account has been deactivated');
                                }
                            } else {
                                localStorage.removeItem('currentUser');
                            }
                        });
                } catch (e) {
                    localStorage.removeItem('currentUser');
                }
            }
        }
        
        // Load dashboard data
        function loadDashboardData() {
            // Load statistics
            Promise.all([
                database.ref('taskLogs').once('value'),
                database.ref('operationLogs').once('value'),
                database.ref('locationLogs').once('value'),
                database.ref('vehicles').once('value'),
                database.ref('shops').once('value'),
                database.ref('boats').once('value'),
                database.ref('cctv').once('value'),
                database.ref('monitoring').once('value')
            ]).then((results) => {
                updateDashboardStats(results);
                updateRecentActivity(results);
            }).catch(error => {
                console.error('Error loading dashboard data:', error);
            });
        }
        
        // Update dashboard statistics
        function updateDashboardStats(results) {
            const [
                taskSnapshot, 
                operationSnapshot, 
                locationSnapshot, 
                vehicleSnapshot, 
                shopSnapshot, 
                boatSnapshot, 
                cctvSnapshot,
                monitoringSnapshot
            ] = results;
            
            const statsContainer = document.getElementById('dashboard-stats');
            
            // Filter data by selected island
            const filterByIsland = (data) => {
                if (!selectedIsland) return data;
                return Object.values(data).filter(item => item.island === selectedIsland);
            };
            
            const tasks = taskSnapshot.val() ? filterByIsland(taskSnapshot.val()) : [];
            const operations = operationSnapshot.val() ? filterByIsland(operationSnapshot.val()) : [];
            const locations = locationSnapshot.val() ? filterByIsland(locationSnapshot.val()) : [];
            const vehicles = vehicleSnapshot.val() ? filterByIsland(vehicleSnapshot.val()) : [];
            const shops = shopSnapshot.val() ? filterByIsland(shopSnapshot.val()) : [];
            const boats = boatSnapshot.val() ? filterByIsland(boatSnapshot.val()) : [];
            const cctv = cctvSnapshot.val() ? filterByIsland(cctvSnapshot.val()) : [];
            const monitoring = monitoringSnapshot.val() ? filterByIsland(monitoringSnapshot.val()) : [];
            
            // Count shops with CCTV
            const shopsWithCCTV = shops.filter(shop => shop.cctvAvailable).length;
            
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="stat-value">${tasks.length}</div>
                    <div class="stat-label">Tasks</div>
                    <div class="stat-change positive-change">
                        <i class="fas fa-arrow-up"></i> Today: ${getTodayCount(tasks)}
                    </div>
                </div>
                
                <div class="stat-card vehicle">
                    <div class="stat-icon">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="stat-value">${vehicles.length}</div>
                    <div class="stat-label">Vehicles</div>
                    <div class="stat-change">
                        Normal: ${vehicles.filter(v => v.status === 'normal').length}
                    </div>
                </div>
                
                <div class="stat-card shop">
                    <div class="stat-icon">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="stat-value">${shops.length}</div>
                    <div class="stat-label">Shops</div>
                    <div class="stat-change">
                        CCTV: ${shopsWithCCTV}
                    </div>
                </div>
                
                <div class="stat-card cctv">
                    <div class="stat-icon">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="stat-value">${cctv.length}</div>
                    <div class="stat-label">CCTV Cameras</div>
                    <div class="stat-change">
                        Active: ${cctv.filter(c => c.status === 'active').length}
                    </div>
                </div>
                
                <div class="stat-card boat">
                    <div class="stat-icon">
                        <i class="fas fa-ship"></i>
                    </div>
                    <div class="stat-value">${boats.length}</div>
                    <div class="stat-label">Boats/Dinghy</div>
                </div>
                
                <div class="stat-card monitoring">
                    <div class="stat-icon">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div class="stat-value">${monitoring.length}</div>
                    <div class="stat-label">Monitoring</div>
                    <div class="stat-change negative-change">
                        <i class="fas fa-exclamation-triangle"></i> Issues
                    </div>
                </div>
            `;
        }
        
        // Get count of items from today
        function getTodayCount(items) {
            const today = new Date().toDateString();
            return items.filter(item => {
                const itemDate = new Date(item.timestamp || item.createdAt || item.markedAt).toDateString();
                return itemDate === today;
            }).length;
        }
        
        // Update recent activity
        function updateRecentActivity(results) {
            const [
                taskSnapshot, 
                operationSnapshot, 
                locationSnapshot, 
                vehicleSnapshot, 
                shopSnapshot, 
                boatSnapshot,
                cctvSnapshot
            ] = results;
            
            // Combine all activities
            let allActivities = [];
            
            // Add tasks
            if (taskSnapshot.val()) {
                Object.entries(taskSnapshot.val()).forEach(([id, task]) => {
                    allActivities.push({
                        type: 'task',
                        id: id,
                        title: `Task: ${task.island}`,
                        description: task.messageEn || task.messageDv || 'No message',
                        timestamp: task.timestamp,
                        island: task.island
                    });
                });
            }
            
            // Add vehicles
            if (vehicleSnapshot.val()) {
                Object.entries(vehicleSnapshot.val()).forEach(([id, vehicle]) => {
                    allActivities.push({
                        type: 'vehicle',
                        id: id,
                        title: `Vehicle: ${vehicle.number}`,
                        description: `${vehicle.type} - ${vehicle.legalOwner}`,
                        timestamp: vehicle.createdAt,
                        island: vehicle.island
                    });
                });
            }
            
            // Add shops
            if (shopSnapshot.val()) {
                Object.entries(shopSnapshot.val()).forEach(([id, shop]) => {
                    allActivities.push({
                        type: 'shop',
                        id: id,
                        title: `Shop: ${shop.name}`,
                        description: `${shop.description} - ${shop.owner}`,
                        timestamp: shop.createdAt,
                        island: shop.island
                    });
                });
            }
            
            // Add boats
            if (boatSnapshot.val()) {
                Object.entries(boatSnapshot.val()).forEach(([id, boat]) => {
                    allActivities.push({
                        type: 'boat',
                        id: id,
                        title: `Vessel: ${boat.name}`,
                        description: `${boat.type} - ${boat.owner}`,
                        timestamp: boat.createdAt,
                        island: boat.island
                    });
                });
            }
            
            // Add CCTV
            if (cctvSnapshot.val()) {
                Object.entries(cctvSnapshot.val()).forEach(([id, cctv]) => {
                    allActivities.push({
                        type: 'cctv',
                        id: id,
                        title: `CCTV: ${cctv.locationName}`,
                        description: `${cctv.locationType} - ${cctv.island}`,
                        timestamp: cctv.createdAt,
                        island: cctv.island
                    });
                });
            }
            
            // Sort by timestamp (newest first)
            allActivities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            // Take only the 10 most recent
            const recentActivities = allActivities.slice(0, 10);
            
            // Update UI
            const activityList = document.getElementById('recent-activity-list');
            
            if (recentActivities.length === 0) {
                activityList.innerHTML = `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-history"></i>
                        <p>No recent activity</p>
                    </div>
                `;
                return;
            }
            
            activityList.innerHTML = recentActivities.map(activity => {
                const time = new Date(activity.timestamp).toLocaleString();
                const iconClass = activity.type === 'vehicle' ? 'fa-car vehicle' : 
                                 activity.type === 'shop' ? 'fa-store shop' : 
                                 activity.type === 'boat' ? 'fa-ship boat' :
                                 activity.type === 'cctv' ? 'fa-video cctv' : 
                                 'fa-tasks task';
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon ${activity.type}">
                            <i class="fas ${iconClass}"></i>
                        </div>
                        <div class="activity-details">
                            <strong>${escapeHtml(activity.title)}</strong>
                            <p style="margin: 5px 0; color: var(--text-light);">${escapeHtml(activity.description.substring(0, 50))}${activity.description.length > 50 ? '...' : ''}</p>
                            <div class="activity-time">
                                <i class="fas fa-map-marker-alt"></i> ${escapeHtml(activity.island)} | 
                                <i class="fas fa-clock"></i> ${time}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ============ DATA MANAGEMENT FUNCTIONS ============
        
        // Global data storage
        let taskLogs = [];
        let operationLogs = [];
        let locationLogs = [];
        let vehicles = [];
        let shops = [];
        let boats = [];
        let monitoringItems = [];
        let users = [];
        
        // Current item to edit/delete
        let currentEditItem = null;
        let currentDeleteItem = null;
        let currentDataType = null;
        
        // Load task logs
        function loadTaskLogs() {
            database.ref('taskLogs').on('value', (snapshot) => {
                const data = snapshot.val();
                taskLogs = data ? Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                })) : [];
                
                taskLogs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                renderTaskLogs();
            });
        }
        
        // Save task
        async function saveTask() {
            const island = document.getElementById('task-island-select').value;
            const serviceNumber = document.getElementById('task-service-number').value.trim();
            const messageEn = document.getElementById('task-message-en-input').value.trim();
            const messageDv = document.getElementById('task-message-dv-input').value.trim();
            
            if (!island || !serviceNumber || (!messageEn && !messageDv)) {
                showToast('Please fill in all required fields');
                return;
            }
            
            const newTask = {
                island: island,
                serviceNumber: serviceNumber,
                messageEn: messageEn,
                messageDv: messageDv,
                timestamp: new Date().toISOString(),
                createdBy: currentUser.username
            };
            
            try {
                await database.ref('taskLogs').push(newTask);
                document.getElementById('task-island-select').value = '';
                document.getElementById('task-service-number').value = '';
                document.getElementById('task-message-en-input').value = '';
                document.getElementById('task-message-dv-input').value = '';
                document.getElementById('task-entry-form').style.display = 'none';
                showToast('Task saved successfully');
            } catch (error) {
                console.error('Error saving task:', error);
                showToast('Error saving task');
            }
        }
        
        // Render task logs
        function renderTaskLogs() {
            const filterIsland = document.getElementById('task-filter-island').value;
            const searchTerm = document.getElementById('task-search').value.toLowerCase();
            
            let filteredTasks = taskLogs;
            
            if (filterIsland) {
                filteredTasks = filteredTasks.filter(task => task.island === filterIsland);
            }
            
            if (searchTerm) {
                filteredTasks = filteredTasks.filter(task => 
                    task.serviceNumber.toLowerCase().includes(searchTerm) ||
                    (task.messageEn && task.messageEn.toLowerCase().includes(searchTerm)) ||
                    (task.messageDv && task.messageDv.toLowerCase().includes(searchTerm)) ||
                    task.island.toLowerCase().includes(searchTerm)
                );
            }
            
            document.getElementById('task-total-count').textContent = `Total Tasks: ${taskLogs.length}`;
            document.getElementById('task-filtered-count').textContent = `Filtered: ${filteredTasks.length}`;
            
            const container = document.getElementById('task-log-container');
            
            if (filteredTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tasks"></i>
                        <p>No tasks found. ${filterIsland || searchTerm ? 'Try changing the filter.' : 'Create your first task!'}</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredTasks.map(log => {
                const timestamp = new Date(log.timestamp).toLocaleString();
                const hasEnglish = log.messageEn && log.messageEn.trim() !== '';
                const hasDhivehi = log.messageDv && log.messageDv.trim() !== '';
                
                let messagesHtml = '';
                
                if (hasEnglish || hasDhivehi) {
                    messagesHtml = `
                        <div class="separate-copy-section">
                            <div class="copy-title">
                                <i class="fas fa-copy"></i> Copy Messages Separately
                            </div>
                            ${hasEnglish ? `
                                <div class="copy-item english-message-item">
                                    <div class="message-type">
                                        <i class="fas fa-flag-usa"></i> English Message
                                    </div>
                                    <div class="copy-content">
                                        ${escapeHtml(log.messageEn)}
                                    </div>
                                    <button class="copy-icon" onclick="copyText('${escapeHtml(log.messageEn)}', 'English Task Message')" title="Copy English Message">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            ` : ''}
                            ${hasDhivehi ? `
                                <div class="copy-item dhivehi-message-item">
                                    <div class="message-type">
                                        <i class="fas fa-language"></i> Dhivehi Message
                                    </div>
                                    <div class="copy-content dhivehi-text">
                                        ${escapeHtml(log.messageDv)}
                                    </div>
                                    <button class="copy-icon" onclick="copyText('${escapeHtml(log.messageDv)}', 'Dhivehi Task Message')" title="Copy Dhivehi Message">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
                
                return `
                    <div class="log-item">
                        ${isAdmin ? `
                            <div class="data-actions">
                                <div class="edit-data-btn" onclick="editItem('task', '${escapeHtml(log.id)}')" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div class="delete-data-btn" onclick="deleteItem('task', '${escapeHtml(log.id)}')" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </div>
                            </div>
                        ` : ''}
                        <div class="log-header">
                            <span class="island-name">${escapeHtml(log.island)}</span>
                            <span class="timestamp">${timestamp}</span>
                        </div>
                        <div class="service-number">Service Number: ${escapeHtml(log.serviceNumber)}</div>
                        ${messagesHtml}
                    </div>
                `;
            }).join('');
        }
        
        // Load operation logs
        function loadOperationLogs() {
            database.ref('operationLogs').on('value', (snapshot) => {
                const data = snapshot.val();
                operationLogs = data ? Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                })) : [];
                
                operationLogs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                renderOperationLogs();
            });
        }
        
        // Save operation
        async function saveOperation() {
            const island = document.getElementById('operation-island-select').value;
            const serviceNumber = document.getElementById('operation-service-number').value.trim();
            const messageEn = document.getElementById('operation-message-en-input').value.trim();
            const messageDv = document.getElementById('operation-message-dv-input').value.trim();
            
            if (!island || !serviceNumber || (!messageEn && !messageDv)) {
                showToast('Please fill in all required fields');
                return;
            }
            
            const newOperation = {
                island: island,
                serviceNumber: serviceNumber,
                messageEn: messageEn,
                messageDv: messageDv,
                timestamp: new Date().toISOString(),
                createdBy: currentUser.username
            };
            
            try {
                await database.ref('operationLogs').push(newOperation);
                document.getElementById('operation-island-select').value = '';
                document.getElementById('operation-service-number').value = '';
                document.getElementById('operation-message-en-input').value = '';
                document.getElementById('operation-message-dv-input').value = '';
                document.getElementById('operation-entry-form').style.display = 'none';
                showToast('Operation saved successfully');
            } catch (error) {
                console.error('Error saving operation:', error);
                showToast('Error saving operation');
            }
        }
        
        // Render operation logs
        function renderOperationLogs() {
            const filterIsland = document.getElementById('operation-filter-island').value;
            const searchTerm = document.getElementById('operation-search').value.toLowerCase();
            
            let filteredOperations = operationLogs;
            
            if (filterIsland) {
                filteredOperations = filteredOperations.filter(op => op.island === filterIsland);
            }
            
            if (searchTerm) {
                filteredOperations = filteredOperations.filter(op => 
                    op.serviceNumber.toLowerCase().includes(searchTerm) ||
                    (op.messageEn && op.messageEn.toLowerCase().includes(searchTerm)) ||
                    (op.messageDv && op.messageDv.toLowerCase().includes(searchTerm)) ||
                    op.island.toLowerCase().includes(searchTerm)
                );
            }
            
            document.getElementById('operation-total-count').textContent = `Total Operations: ${operationLogs.length}`;
            document.getElementById('operation-filtered-count').textContent = `Filtered: ${filteredOperations.length}`;
            
            const container = document.getElementById('operation-log-container');
            
            if (filteredOperations.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>No operations found. ${filterIsland || searchTerm ? 'Try changing the filter.' : 'Create your first operation!'}</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredOperations.map(log => {
                const timestamp = new Date(log.timestamp).toLocaleString();
                const hasEnglish = log.messageEn && log.messageEn.trim() !== '';
                const hasDhivehi = log.messageDv && log.messageDv.trim() !== '';
                
                let messagesHtml = '';
                
                if (hasEnglish || hasDhivehi) {
                    messagesHtml = `
                        <div class="separate-copy-section">
                            <div class="copy-title">
                                <i class="fas fa-copy"></i> Copy Messages Separately
                            </div>
                            ${hasEnglish ? `
                                <div class="copy-item english-message-item">
                                    <div class="message-type">
                                        <i class="fas fa-flag-usa"></i> English Message
                                    </div>
                                    <div class="copy-content">
                                        ${escapeHtml(log.messageEn)}
                                    </div>
                                    <button class="copy-icon" onclick="copyText('${escapeHtml(log.messageEn)}', 'English Operation Message')" title="Copy English Message">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            ` : ''}
                            ${hasDhivehi ? `
                                <div class="copy-item dhivehi-message-item">
                                    <div class="message-type">
                                        <i class="fas fa-language"></i> Dhivehi Message
                                    </div>
                                    <div class="copy-content dhivehi-text">
                                        ${escapeHtml(log.messageDv)}
                                    </div>
                                    <button class="copy-icon" onclick="copyText('${escapeHtml(log.messageDv)}', 'Dhivehi Operation Message')" title="Copy Dhivehi Message">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
                
                return `
                    <div class="log-item">
                        ${isAdmin ? `
                            <div class="data-actions">
                                <div class="edit-data-btn" onclick="editItem('operation', '${escapeHtml(log.id)}')" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div class="delete-data-btn" onclick="deleteItem('operation', '${escapeHtml(log.id)}')" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </div>
                            </div>
                        ` : ''}
                        <div class="log-header">
                            <span class="island-name">${escapeHtml(log.island)}</span>
                            <span class="timestamp">${timestamp}</span>
                        </div>
                        <div class="service-number">Service Number: ${escapeHtml(log.serviceNumber)}</div>
                        ${messagesHtml}
                    </div>
                `;
            }).join('');
        }
        
        // Load location logs
        function loadLocationLogs() {
            database.ref('locationLogs').on('value', (snapshot) => {
                const data = snapshot.val();
                locationLogs = data ? Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                })) : [];
                
                locationLogs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                renderLocationLogs();
            });
        }
        
        // Save location
        async function saveLocation() {
            const island = document.getElementById('location-island-select').value;
            const locationName = document.getElementById('location-name').value.trim();
            const remarks = document.getElementById('location-remarks').value.trim();
            
            if (!island || !locationName || !remarks) {
                showToast('Please fill in all required fields');
                return;
            }
            
            const newLocation = {
                island: island,
                locationName: locationName,
                remarks: remarks,
                timestamp: new Date().toISOString(),
                createdBy: currentUser.username
            };
            
            try {
                await database.ref('locationLogs').push(newLocation);
                document.getElementById('location-island-select').value = '';
                document.getElementById('location-name').value = '';
                document.getElementById('location-remarks').value = '';
                document.getElementById('location-entry-form').style.display = 'none';
                showToast('Location saved successfully');
            } catch (error) {
                console.error('Error saving location:', error);
                showToast('Error saving location');
            }
        }
        
        // Render location logs
        function renderLocationLogs() {
            const filterIsland = document.getElementById('location-filter-island').value;
            const searchTerm = document.getElementById('location-search').value.toLowerCase();
            
            let filteredLocations = locationLogs;
            
            if (filterIsland) {
                filteredLocations = filteredLocations.filter(loc => loc.island === filterIsland);
            }
            
            if (searchTerm) {
                filteredLocations = filteredLocations.filter(loc => 
                    loc.locationName.toLowerCase().includes(searchTerm) ||
                    loc.remarks.toLowerCase().includes(searchTerm) ||
                    loc.island.toLowerCase().includes(searchTerm)
                );
            }
            
            document.getElementById('location-total-count').textContent = `Total Locations: ${locationLogs.length}`;
            document.getElementById('location-filtered-count').textContent = `Filtered: ${filteredLocations.length}`;
            
            const container = document.getElementById('location-log-container');
            
            if (filteredLocations.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-map-marker-alt"></i>
                        <p>No locations found. ${filterIsland || searchTerm ? 'Try changing the filter.' : 'Create your first location!'}</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredLocations.map(log => {
                const timestamp = new Date(log.timestamp).toLocaleString();
                
                return `
                    <div class="log-item">
                        ${isAdmin ? `
                            <div class="data-actions">
                                <div class="edit-data-btn" onclick="editItem('location', '${escapeHtml(log.id)}')" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div class="delete-data-btn" onclick="deleteItem('location', '${escapeHtml(log.id)}')" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </div>
                            </div>
                        ` : ''}
                        <div class="log-header">
                            <span class="island-name">${escapeHtml(log.island)}</span>
                            <span class="timestamp">${timestamp}</span>
                        </div>
                        
                        <div class="separate-copy-section">
                            <div class="copy-title">
                                <i class="fas fa-copy"></i> Copy Location Details Separately
                            </div>
                            
                            <div class="copy-item location-name-item">
                                <div class="message-type">
                                    <i class="fas fa-map-marker-alt"></i> Location Name
                                </div>
                                <div class="copy-content">
                                    ${escapeHtml(log.locationName)}
                                </div>
                                <button class="copy-icon" onclick="copyText('${escapeHtml(log.locationName)}', 'Location Name')" title="Copy Location Name">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            
                            <div class="copy-item remarks-item">
                                <div class="message-type">
                                    <i class="fas fa-comment"></i> Remarks
                                </div>
                                <div class="copy-content">
                                    ${escapeHtml(log.remarks)}
                                </div>
                                <button class="copy-icon" onclick="copyText('${escapeHtml(log.remarks)}', 'Location Remarks')" title="Copy Remarks">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Load vehicles
        function loadVehicles() {
            database.ref('vehicles').on('value', (snapshot) => {
                const data = snapshot.val();
                vehicles = data ? Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                })) : [];
                
                vehicles.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                renderVehiclesTable();
            });
        }
        
        // Save vehicle
        async function saveVehicle() {
            const island = document.getElementById('vehicle-island').value;
            const type = document.getElementById('vehicle-type').value;
            const legalOwner = document.getElementById('vehicle-legal-owner').value.trim();
            const beneficialOwner = document.getElementById('vehicle-beneficial-owner').value.trim();
            const number = document.getElementById('vehicle-number').value.trim();
            const contact = document.getElementById('vehicle-owner-contact').value.trim();
            const notes = document.getElementById('vehicle-notes').value.trim();
            const imageFile = document.getElementById('vehicle-image-upload').files[0];
            
            if (!island || !type || !legalOwner || !beneficialOwner || !number || !contact) {
                showToast('Please fill in all required fields');
                return;
            }
            
            if (!imageFile) {
                showToast('Please upload a vehicle image');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = async function(event) {
                const imageData = event.target.result;
                const newVehicle = {
                    island: island,
                    type: type,
                    legalOwner: legalOwner,
                    beneficialOwner: beneficialOwner,
                    number: number,
                    contact: contact,
                    notes: notes,
                    image: imageData,
                    status: 'normal',
                    createdAt: new Date().toISOString(),
                    createdBy: currentUser.username
                };
                
                try {
                    await database.ref('vehicles').push(newVehicle);
                    document.getElementById('vehicleForm').reset();
                    document.getElementById('vehicle-image-preview').innerHTML = '<span class="plus-sign">+</span>';
                    toggleForm('vehicle', false);
                    showToast('Vehicle registered successfully!');
                } catch (error) {
                    console.error('Error saving vehicle:', error);
                    showToast('Error saving vehicle');
                }
            };
            
            reader.readAsDataURL(imageFile);
        }
        
        // Render vehicles table
        function renderVehiclesTable() {
            const filterIsland = document.getElementById('vehicle-filter-island').value;
            const filterType = document.getElementById('vehicle-filter-type').value;
            const filterStatus = document.getElementById('vehicle-filter-status').value;
            const searchTerm = document.getElementById('vehicle-search').value.toLowerCase();
            
            let filteredVehicles = vehicles;
            
            if (filterIsland) {
                filteredVehicles = filteredVehicles.filter(v => v.island === filterIsland);
            }
            
            if (filterType) {
                filteredVehicles = filteredVehicles.filter(v => v.type === filterType);
            }
            
            if (filterStatus) {
                filteredVehicles = filteredVehicles.filter(v => v.status === filterStatus);
            }
            
            if (searchTerm) {
                filteredVehicles = filteredVehicles.filter(v => 
                    v.number.toLowerCase().includes(searchTerm) ||
                    v.legalOwner.toLowerCase().includes(searchTerm) ||
                    v.beneficialOwner.toLowerCase().includes(searchTerm) ||
                    v.island.toLowerCase().includes(searchTerm)
                );
            }
            
            document.getElementById('vehicle-total-count').textContent = `Total Vehicles: ${vehicles.length}`;
            document.getElementById('vehicle-filtered-count').textContent = `Filtered: ${filteredVehicles.length}`;
            
            const tbody = document.getElementById('vehicles-table-body');
            
            if (filteredVehicles.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 30px;">
                            <div class="empty-state" style="padding: 0;">
                                <i class="fas fa-car"></i>
                                <p>No vehicles found. ${filterIsland || filterType || filterStatus || searchTerm ? 'Try changing the filter.' : 'Register your first vehicle!'}</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredVehicles.map(vehicle => {
                const statusClass = vehicle.status === 'normal' ? 'status-normal' : 
                                  vehicle.status === 'traffic_issue' ? 'status-issue' : 
                                  'status-critical';
                
                const statusText = vehicle.status === 'normal' ? 'Normal' : 
                                 vehicle.status === 'traffic_issue' ? 'Traffic Violation' : 
                                 'Other Issue';
                
                return `
                    <tr>
                        <td>
                            ${vehicle.image ? 
                                `<img src="${vehicle.image}" class="vehicle-image-small" alt="Vehicle" onclick="viewImage('${vehicle.image}', 'Vehicle Image')" title="Click to view full image">` : 
                                '<i class="fas fa-car" style="color: var(--text-light);"></i>'
                            }
                        </td>
                        <td>${escapeHtml(vehicle.island)}</td>
                        <td>${escapeHtml(vehicle.type)}</td>
                        <td><strong>${escapeHtml(vehicle.number)}</strong></td>
                        <td>${escapeHtml(vehicle.legalOwner)}</td>
                        <td>${escapeHtml(vehicle.beneficialOwner)}</td>
                        <td class="owner-contact-cell" title="${escapeHtml(vehicle.contact)}">${escapeHtml(vehicle.contact)}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="mark-btn mark-traffic" onclick="markForMonitoring('vehicle', '${escapeHtml(vehicle.id)}', 'traffic_issue', 'Traffic violation reported')" title="Mark Traffic Violation">
                                    <i class="fas fa-traffic-light"></i>
                                </button>
                                <button class="mark-btn mark-other" onclick="markForMonitoring('vehicle', '${escapeHtml(vehicle.id)}', 'other_issue', 'Other issue reported')" title="Mark Other Issue">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </button>
                                ${isAdmin ? `
                                    <button class="mark-btn" onclick="editItem('vehicle', '${escapeHtml(vehicle.id)}')" title="Edit" style="background-color: var(--warning-color); color: white; border: none;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="mark-btn" onclick="deleteItem('vehicle', '${escapeHtml(vehicle.id)}')" title="Delete" style="background-color: var(--danger-color); color: white; border: none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Load shops
        function loadShops() {
            database.ref('shops').on('value', (snapshot) => {
                const data = snapshot.val();
                shops = data ? Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                })) : [];
                
                shops.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                renderShopsTable();
            });
        }
        
        // Save shop
        async function saveShop() {
            const island = document.getElementById('shop-island').value;
            const name = document.getElementById('shop-name').value.trim();
            const owner = document.getElementById('shop-owner').value.trim();
            const ownerId = document.getElementById('shop-owner-id').value.trim();
            const contact = document.getElementById('shop-contact').value.trim();
            const location = document.getElementById('shop-location').value.trim();
            const description = document.getElementById('shop-description').value;
            const cctvAvailable = document.getElementById('shop-cctv-available').checked;
            const imageFile = document.getElementById('shop-image-upload').files[0];
            
            if (!island || !name || !owner || !ownerId || !contact || !description) {
                showToast('Please fill in all required fields');
                return;
            }
            
            if (!imageFile) {
                showToast('Please upload a shop image');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = async function(event) {
                const imageData = event.target.result;
                const newShop = {
                    island: island,
                    name: name,
                    owner: owner,
                    ownerId: ownerId,
                    contact: contact,
                    location: location,
                    description: description,
                    cctvAvailable: cctvAvailable,
                    image: imageData,
                    createdAt: new Date().toISOString(),
                    createdBy: currentUser.username
                };
                
                try {
                    await database.ref('shops').push(newShop);
                    document.getElementById('shopForm').reset();
                    document.getElementById('shop-image-preview').innerHTML = '<span class="plus-sign">+</span>';
                    toggleForm('shop', false);
                    showToast('Shop registered successfully!');
                } catch (error) {
                    console.error('Error saving shop:', error);
                    showToast('Error saving shop');
                }
            };
            
            reader.readAsDataURL(imageFile);
        }
        
        // Render shops table
        function renderShopsTable() {
            const filterIsland = document.getElementById('shop-filter-island').value;
            const filterType = document.getElementById('shop-filter-type').value;
            const filterCCTV = document.getElementById('shop-filter-cctv').value;
            const searchTerm = document.getElementById('shop-search').value.toLowerCase();
            
            let filteredShops = shops;
            
            if (filterIsland) {
                filteredShops = filteredShops.filter(s => s.island === filterIsland);
            }
            
            if (filterType) {
                filteredShops = filteredShops.filter(s => s.description === filterType);
            }
            
            if (filterCCTV === 'yes') {
                filteredShops = filteredShops.filter(s => s.cctvAvailable === true);
            } else if (filterCCTV === 'no') {
                filteredShops = filteredShops.filter(s => !s.cctvAvailable || s.cctvAvailable === false);
            }
            
            if (searchTerm) {
                filteredShops = filteredShops.filter(s => 
                    s.name.toLowerCase().includes(searchTerm) ||
                    s.owner.toLowerCase().includes(searchTerm) ||
                    s.contact.toLowerCase().includes(searchTerm) ||
                    s.island.toLowerCase().includes(searchTerm)
                );
            }
            
            document.getElementById('shop-total-count').textContent = `Total Shops: ${shops.length}`;
            document.getElementById('shop-filtered-count').textContent = `Filtered: ${filteredShops.length}`;
            
            const tbody = document.getElementById('shops-table-body');
            
            if (filteredShops.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 30px;">
                            <div class="empty-state" style="padding: 0;">
                                <i class="fas fa-store"></i>
                                <p>No shops found. ${filterIsland || filterType || filterCCTV || searchTerm ? 'Try changing the filter.' : 'Register your first shop!'}</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredShops.map(shop => {
                const cctvBadge = shop.cctvAvailable ? 
                    '<span class="status-badge status-normal"><i class="fas fa-video"></i> CCTV</span>' : 
                    '<span class="status-badge" style="background-color: rgba(108, 117, 125, 0.1); color: #6c757d;">No CCTV</span>';
                
                return `
                    <tr>
                        <td>
                            ${shop.image ? 
                                `<img src="${shop.image}" class="shop-image-small" alt="Shop" onclick="viewImage('${shop.image}', 'Shop Image')" title="Click to view full image">` : 
                                '<i class="fas fa-store" style="color: var(--text-light);"></i>'
                            }
                        </td>
                        <td>${escapeHtml(shop.island)}</td>
                        <td><strong>${escapeHtml(shop.name)}</strong></td>
                        <td>${escapeHtml(shop.owner)}<br><small>ID: ${escapeHtml(shop.ownerId)}</small></td>
                        <td>${escapeHtml(shop.contact)}</td>
                        <td>${escapeHtml(shop.description)}</td>
                        <td>${cctvBadge}</td>
                        <td>${escapeHtml(shop.location || 'Not specified')}</td>
                        <td>
                            <div class="table-actions">
                                <button class="mark-btn mark-other" onclick="markForMonitoring('shop', '${escapeHtml(shop.id)}', 'other_issue', 'Shop inspection required')" title="Mark for Monitoring">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${isAdmin ? `
                                    <button class="mark-btn" onclick="editItem('shop', '${escapeHtml(shop.id)}')" title="Edit" style="background-color: var(--warning-color); color: white; border: none;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="mark-btn" onclick="deleteItem('shop', '${escapeHtml(shop.id)}')" title="Delete" style="background-color: var(--danger-color); color: white; border: none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Load boats
        function loadBoats() {
            database.ref('boats').on('value', (snapshot) => {
                const data = snapshot.val();
                boats = data ? Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                })) : [];
                
                boats.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                renderBoatsTable();
            });
        }
        
        // Save boat
        async function saveBoat() {
            const island = document.getElementById('boat-island').value;
            const type = document.getElementById('boat-type').value;
            const name = document.getElementById('boat-name').value.trim();
            const owner = document.getElementById('boat-owner').value.trim();
            const ownerId = document.getElementById('boat-owner-id').value.trim();
            const contact = document.getElementById('boat-contact').value.trim();
            const regNumber = document.getElementById('boat-reg-number').value.trim();
            const capacity = document.getElementById('boat-capacity').value.trim();
            const imageFile = document.getElementById('boat-image-upload').files[0];
            
            if (!island || !type || !name || !owner || !ownerId || !contact || !regNumber || !capacity) {
                showToast('Please fill in all required fields');
                return;
            }
            
            if (!imageFile) {
                showToast('Please upload a vessel image');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = async function(event) {
                const imageData = event.target.result;
                const newBoat = {
                    island: island,
                    type: type,
                    name: name,
                    owner: owner,
                    ownerId: ownerId,
                    contact: contact,
                    regNumber: regNumber,
                    capacity: capacity,
                    image: imageData,
                    createdAt: new Date().toISOString(),
                    createdBy: currentUser.username
                };
                
                try {
                    await database.ref('boats').push(newBoat);
                    document.getElementById('boatForm').reset();
                    document.getElementById('boat-image-preview').innerHTML = '<span class="plus-sign">+</span>';
                    toggleForm('boat', false);
                    showToast('Boat registered successfully!');
                } catch (error) {
                    console.error('Error saving boat:', error);
                    showToast('Error saving boat');
                }
            };
            
            reader.readAsDataURL(imageFile);
        }
        
        // Render boats table
        function renderBoatsTable() {
            const filterIsland = document.getElementById('boat-filter-island').value;
            const filterType = document.getElementById('boat-filter-type').value;
            const searchTerm = document.getElementById('boat-search').value.toLowerCase();
            
            let filteredBoats = boats;
            
            if (filterIsland) {
                filteredBoats = filteredBoats.filter(b => b.island === filterIsland);
            }
            
            if (filterType) {
                filteredBoats = filteredBoats.filter(b => b.type === filterType);
            }
            
            if (searchTerm) {
                filteredBoats = filteredBoats.filter(b => 
                    b.name.toLowerCase().includes(searchTerm) ||
                    b.owner.toLowerCase().includes(searchTerm) ||
                    b.regNumber.toLowerCase().includes(searchTerm) ||
                    b.island.toLowerCase().includes(searchTerm)
                );
            }
            
            document.getElementById('boat-total-count').textContent = `Total Vessels: ${boats.length}`;
            document.getElementById('boat-filtered-count').textContent = `Filtered: ${filteredBoats.length}`;
            
            const tbody = document.getElementById('boats-table-body');
            
            if (filteredBoats.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 30px;">
                            <div class="empty-state" style="padding: 0;">
                                <i class="fas fa-ship"></i>
                                <p>No vessels found. ${filterIsland || filterType || searchTerm ? 'Try changing the filter.' : 'Register your first vessel!'}</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredBoats.map(boat => {
                return `
                    <tr>
                        <td>
                            ${boat.image ? 
                                `<img src="${boat.image}" class="boat-image-small" alt="Boat" onclick="viewImage('${boat.image}', 'Vessel Image')" title="Click to view full image">` : 
                                '<i class="fas fa-ship" style="color: var(--text-light);"></i>'
                            }
                        </td>
                        <td>${escapeHtml(boat.island)}</td>
                        <td>${escapeHtml(boat.type)}</td>
                        <td><strong>${escapeHtml(boat.name)}</strong></td>
                        <td>${escapeHtml(boat.owner)}<br><small>ID: ${escapeHtml(boat.ownerId)}</small></td>
                        <td>${escapeHtml(boat.contact)}</td>
                        <td>${escapeHtml(boat.regNumber)}</td>
                        <td>${escapeHtml(boat.capacity)} persons</td>
                        <td>
                            <div class="table-actions">
                                <button class="mark-btn mark-other" onclick="markForMonitoring('boat', '${escapeHtml(boat.id)}', 'other_issue', 'Vessel inspection required')" title="Mark for Monitoring">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${isAdmin ? `
                                    <button class="mark-btn" onclick="editItem('boat', '${escapeHtml(boat.id)}')" title="Edit" style="background-color: var(--warning-color); color: white; border: none;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="mark-btn" onclick="deleteItem('boat', '${escapeHtml(boat.id)}')" title="Delete" style="background-color: var(--danger-color); color: white; border: none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Load CCTV items
        function loadCCTVItems() {
            database.ref('cctv').on('value', (snapshot) => {
                const data = snapshot.val();
                cctvItems = data ? Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                })) : [];
                
                cctvItems.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                renderCCTVTable();
            });
        }
        
        // Save CCTV
        async function saveCCTV() {
            const island = document.getElementById('cctv-island').value;
            const locationType = document.getElementById('cctv-location-type').value;
            const locationName = document.getElementById('cctv-location-name').value.trim();
            const areaName = document.getElementById('cctv-area-name').value.trim();
            const installationDate = document.getElementById('cctv-installation-date').value;
            const status = document.getElementById('cctv-status').value;
            const notes = document.getElementById('cctv-notes').value.trim();
            const imageFile = document.getElementById('cctv-image-upload').files[0];
            
            if (!island || !locationType || !locationName || !status) {
                showToast('Please fill in all required fields');
                return;
            }
            
            if (!imageFile) {
                showToast('Please upload a CCTV location image');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = async function(event) {
                const imageData = event.target.result;
                const newCCTV = {
                    island: island,
                    locationType: locationType,
                    locationName: locationName,
                    areaName: areaName,
                    installationDate: installationDate,
                    status: status,
                    notes: notes,
                    image: imageData,
                    createdAt: new Date().toISOString(),
                    createdBy: currentUser.username
                };
                
                try {
                    await database.ref('cctv').push(newCCTV);
                    document.getElementById('cctvForm').reset();
                    document.getElementById('cctv-image-preview').innerHTML = '<span class="plus-sign">+</span>';
                    toggleForm('cctv', false);
                    showToast('CCTV camera registered successfully!');
                } catch (error) {
                    console.error('Error saving CCTV:', error);
                    showToast('Error saving CCTV camera');
                }
            };
            
            reader.readAsDataURL(imageFile);
        }
        
        // Render CCTV table
        function renderCCTVTable() {
            const filterIsland = document.getElementById('cctv-filter-island').value;
            const filterLocationType = document.getElementById('cctv-filter-location-type').value;
            const filterStatus = document.getElementById('cctv-filter-status').value;
            const searchTerm = document.getElementById('cctv-search').value.toLowerCase();
            
            let filteredCCTV = cctvItems;
            
            if (filterIsland) {
                filteredCCTV = filteredCCTV.filter(c => c.island === filterIsland);
            }
            
            if (filterLocationType) {
                filteredCCTV = filteredCCTV.filter(c => c.locationType === filterLocationType);
            }
            
            if (filterStatus) {
                filteredCCTV = filteredCCTV.filter(c => c.status === filterStatus);
            }
            
            if (searchTerm) {
                filteredCCTV = filteredCCTV.filter(c => 
                    c.locationName.toLowerCase().includes(searchTerm) ||
                    (c.areaName && c.areaName.toLowerCase().includes(searchTerm)) ||
                    c.island.toLowerCase().includes(searchTerm)
                );
            }
            
            document.getElementById('cctv-total-count').textContent = `Total CCTV Cameras: ${cctvItems.length}`;
            document.getElementById('cctv-filtered-count').textContent = `Filtered: ${filteredCCTV.length}`;
            
            const tbody = document.getElementById('cctv-table-body');
            
            if (filteredCCTV.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 30px;">
                            <div class="empty-state" style="padding: 0;">
                                <i class="fas fa-video"></i>
                                <p>No CCTV cameras found. ${filterIsland || filterLocationType || filterStatus || searchTerm ? 'Try changing the filter.' : 'Register your first CCTV camera!'}</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredCCTV.map(cctv => {
                const statusClass = cctv.status === 'active' ? 'status-normal' : 
                                  cctv.status === 'inactive' ? 'status-critical' : 
                                  'status-issue';
                
                const statusText = cctv.status === 'active' ? 'Active' : 
                                 cctv.status === 'inactive' ? 'Inactive' : 
                                 'Maintenance';
                
                const installationDate = cctv.installationDate ? 
                    new Date(cctv.installationDate).toLocaleDateString() : 'Not set';
                
                return `
                    <tr>
                        <td>
                            ${cctv.image ? 
                                `<img src="${cctv.image}" class="cctv-image-small" alt="CCTV" onclick="viewImage('${cctv.image}', 'CCTV Location Image')" title="Click to view full image">` : 
                                '<i class="fas fa-video" style="color: var(--text-light);"></i>'
                            }
                        </td>
                        <td>${escapeHtml(cctv.island)}</td>
                        <td>${escapeHtml(cctv.locationType)}</td>
                        <td><strong>${escapeHtml(cctv.locationName)}</strong></td>
                        <td>${escapeHtml(cctv.areaName || 'Not specified')}</td>
                        <td>${installationDate}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <div class="table-actions">
                                <button class="mark-btn mark-other" onclick="markForMonitoring('cctv', '${escapeHtml(cctv.id)}', 'other_issue', 'CCTV inspection required')" title="Mark for Monitoring">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${isAdmin ? `
                                    <button class="mark-btn" onclick="editItem('cctv', '${escapeHtml(cctv.id)}')" title="Edit" style="background-color: var(--warning-color); color: white; border: none;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="mark-btn" onclick="deleteItem('cctv', '${escapeHtml(cctv.id)}')" title="Delete" style="background-color: var(--danger-color); color: white; border: none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Load monitoring items
        function loadMonitoringItems() {
            database.ref('monitoring').on('value', (snapshot) => {
                const data = snapshot.val();
                monitoringItems = data ? Object.entries(data).map(([key, value]) => ({
                    id: key,
                    ...value
                })) : [];
                
                monitoringItems.sort((a, b) => new Date(b.markedAt) - new Date(a.markedAt));
                renderMonitoringItems();
            });
        }
        
        // Render monitoring items
        function renderMonitoringItems() {
            const filterType = document.getElementById('monitoring-filter-type').value;
            const filterStatus = document.getElementById('monitoring-filter-status').value;
            const filterIsland = document.getElementById('monitoring-filter-island').value;
            
            let filteredItems = monitoringItems;
            
            if (filterType) {
                filteredItems = filteredItems.filter(item => item.type === filterType);
            }
            
            if (filterStatus) {
                filteredItems = filteredItems.filter(item => item.issueType === filterStatus);
            }
            
            if (filterIsland) {
                filteredItems = filteredItems.filter(item => item.island === filterIsland);
            }
            
            document.getElementById('monitoring-total-count').textContent = `Total Items: ${filteredItems.length}`;
            
            const container = document.getElementById('monitoring-container');
            
            if (filteredItems.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-eye-slash"></i>
                        <p>No items marked for monitoring. ${filterType || filterStatus || filterIsland ? 'Try changing the filter.' : 'Mark items from Vehicles, Shops, or Boats tabs.'}</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredItems.map(item => {
                const timestamp = new Date(item.markedAt).toLocaleString();
                const issueTypeText = item.issueType === 'traffic_issue' ? 'Traffic Violation' : 'Other Issue';
                const issueTypeClass = item.issueType === 'traffic_issue' ? 'status-issue' : 'status-critical';
                const icon = item.type === 'vehicle' ? 'fa-car' : 
                            item.type === 'shop' ? 'fa-store' : 
                            item.type === 'cctv' ? 'fa-video' :
                            'fa-ship';
                const typeColor = item.type === 'vehicle' ? 'vehicle-color' : 
                                item.type === 'shop' ? 'shop-color' : 
                                item.type === 'cctv' ? 'cctv-color' :
                                'boat-color';
                
                let imageHtml = '';
                if (item.image) {
                    imageHtml = `
                        <div style="margin: 10px 0; text-align: center;">
                            <img src="${item.image}" style="max-width: 150px; max-height: 100px; border-radius: 5px; cursor: pointer;" 
                                 onclick="viewImage('${item.image}', '${item.type.charAt(0).toUpperCase() + item.type.slice(1)} Image')" 
                                 title="Click to view full image">
                        </div>
                    `;
                }
                
                return `
                    <div class="log-item monitoring-item">
                        <div class="monitoring-badge">
                            ${issueTypeText}
                        </div>
                        <div class="log-header">
                            <span class="island-name">${escapeHtml(item.island)}</span>
                            <span class="timestamp">${timestamp}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <i class="fas ${icon} ${typeColor}" style="font-size: 1.5rem;"></i>
                            <div>
                                <h4 style="margin: 0; color: var(--text-color);">${escapeHtml(item.name)}</h4>
                                <p style="margin: 5px 0 0 0; color: var(--text-light);">
                                    <i class="fas fa-user"></i> ${escapeHtml(item.owner)} | 
                                    <i class="fas fa-phone"></i> ${escapeHtml(item.contact)}
                                </p>
                            </div>
                        </div>
                        ${imageHtml}
                        <div class="issue-note">
                            <strong>Issue:</strong> ${escapeHtml(item.issueNote || 'No details provided')}
                        </div>
                        <div style="margin-top: 10px; color: var(--text-light); font-size: 0.9rem;">
                            <i class="fas fa-user-circle"></i> Marked by: ${escapeHtml(item.markedBy)} | 
                            <i class="fas fa-${item.type === 'vehicle' ? 'car' : item.type === 'shop' ? 'store' : item.type === 'cctv' ? 'video' : 'ship'}"></i> Type: ${item.type.charAt(0).toUpperCase() + item.type.slice(1)}
                        </div>
                        ${isAdmin ? `
                            <div class="log-actions">
                                <button class="action-btn delete-btn" onclick="removeFromMonitoring('${escapeHtml(item.id)}', '${escapeHtml(item.type)}', '${escapeHtml(item.itemId)}')">
                                    <i class="fas fa-trash"></i> Remove from Monitoring
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // Load users
        function loadUsers() {
            if (!isAdmin) return;
            
            database.ref('users').once('value')
                .then(snapshot => {
                    users = [];
                    const data = snapshot.val();
                    
                    if (data) {
                        Object.keys(data).forEach(username => {
                            users.push({
                                username: username,
                                ...data[username]
                            });
                        });
                    }
                    
                    updateUsersTable();
                    updateUserStats();
                })
                .catch(error => {
                    console.error('Error loading users:', error);
                    showToast('Error loading users');
                });
        }
        
        // Update users table
        function updateUsersTable() {
            if (!isAdmin) return;
            
            const tbody = document.getElementById('users-table-body');
            
            if (!users.length) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center;">No users found</td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = users.map(user => {
                const lastLogin = user.lastLogin ? 
                    new Date(user.lastLogin).toLocaleString() : 
                    'Never logged in';
                
                return `
                    <tr>
                        <td>${escapeHtml(user.username)}</td>
                        <td>${escapeHtml(user.fullName || 'N/A')}</td>
                        <td>${escapeHtml(user.role || 'user')}</td>
                        <td>${lastLogin}</td>
                        <td>
                            <span class="user-status ${user.isActive ? 'status-active' : 'status-inactive'}">
                                ${user.isActive ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                        <td>
                            <div class="action-icons">
                                ${user.username !== 'av_5637' ? `
                                    <i class="fas fa-edit action-icon" onclick="editItem('user', '${escapeHtml(user.username)}')" title="Edit User"></i>
                                    <i class="fas fa-trash action-icon" onclick="deleteItem('user', '${escapeHtml(user.username)}')" title="Delete User"></i>
                                    <i class="fas fa-${user.isActive ? 'ban' : 'check'} action-icon" 
                                       onclick="toggleUserStatus('${escapeHtml(user.username)}', ${!user.isActive})" 
                                       title="${user.isActive ? 'Deactivate' : 'Activate'}">
                                    </i>
                                ` : '<span style="color: var(--text-light);">Protected</span>'}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Update user statistics
        function updateUserStats() {
            if (!isAdmin) return;
            
            const total = users.length;
            const active = users.filter(u => u.isActive).length;
            const inactive = total - active;
            
            const today = new Date().toDateString();
            const todayLogins = users.filter(u => {
                if (!u.lastLogin) return false;
                const lastLoginDate = new Date(u.lastLogin).toDateString();
                return lastLoginDate === today;
            }).length;
            
            document.getElementById('total-users').textContent = total;
            document.getElementById('active-users').textContent = active;
            document.getElementById('inactive-users').textContent = inactive;
            document.getElementById('today-logins').textContent = todayLogins;
        }
        
        // Save new user
        async function saveNewUser() {
            if (!isAdmin) {
                showToast('Only av_5637 can add users');
                return;
            }
            
            const username = document.getElementById('new-username').value.trim();
            const password = document.getElementById('new-password').value.trim();
            const fullName = document.getElementById('new-fullname').value.trim();
            const role = document.getElementById('new-role').value;
            const isActive = document.getElementById('new-user-active').checked;
            
            if (!username || !password || !fullName) {
                showToast('Please fill all fields');
                return;
            }
            
            // Check if username exists
            const snapshot = await database.ref('users/' + username).once('value');
            if (snapshot.exists()) {
                showToast('Username already exists');
                return;
            }
            
            // Create user object
            const userData = {
                username: username,
                password: password,
                fullName: fullName,
                role: role,
                isActive: isActive,
                createdBy: currentUser.username,
                createdAt: new Date().toISOString(),
                lastLogin: null
            };
            
            try {
                await database.ref('users/' + username).set(userData);
                
                // Clear form
                document.getElementById('new-username').value = '';
                document.getElementById('new-password').value = '';
                document.getElementById('new-fullname').value = '';
                document.getElementById('new-role').value = 'user';
                document.getElementById('new-user-active').checked = true;
                
                // Close modal
                hideModal(document.getElementById('add-user-modal'));
                
                // Refresh user list
                loadUsers();
                
                showToast('User created successfully');
                
            } catch (error) {
                console.error('Error creating user:', error);
                showToast('Error creating user');
            }
        }
        
        // Toggle user status
        async function toggleUserStatus(username, newStatus) {
            if (!isAdmin) {
                showToast('Only av_5637 can modify user status');
                return;
            }
            
            if (username === 'av_5637') {
                showToast('Cannot modify the main administrator account');
                return;
            }
            
            try {
                await database.ref('users/' + username).update({
                    isActive: newStatus
                });
                
                loadUsers();
                showToast(`User ${newStatus ? 'activated' : 'deactivated'} successfully`);
                
            } catch (error) {
                console.error('Error updating user status:', error);
                showToast('Error updating user status');
            }
        }
        
        // Edit item
        function editItem(type, id) {
            if (!isAdmin) {
                showToast('Only av_5637 can edit items');
                return;
            }
            
            let item;
            let title = '';
            let content = '';
            
            switch(type) {
                case 'task':
                    item = taskLogs.find(t => t.id === id);
                    if (!item) return;
                    title = 'Edit Task';
                    content = getTaskEditForm(item);
                    break;
                    
                case 'operation':
                    item = operationLogs.find(o => o.id === id);
                    if (!item) return;
                    title = 'Edit Operation';
                    content = getOperationEditForm(item);
                    break;
                    
                case 'location':
                    item = locationLogs.find(l => l.id === id);
                    if (!item) return;
                    title = 'Edit Location';
                    content = getLocationEditForm(item);
                    break;
                    
                case 'vehicle':
                    item = vehicles.find(v => v.id === id);
                    if (!item) return;
                    title = 'Edit Vehicle';
                    content = getVehicleEditForm(item);
                    break;
                    
                case 'shop':
                    item = shops.find(s => s.id === id);
                    if (!item) return;
                    title = 'Edit Shop';
                    content = getShopEditForm(item);
                    break;
                    
                case 'boat':
                    item = boats.find(b => b.id === id);
                    if (!item) return;
                    title = 'Edit Boat/Dinghy';
                    content = getBoatEditForm(item);
                    break;
                    
                case 'cctv':
                    item = cctvItems.find(c => c.id === id);
                    if (!item) return;
                    title = 'Edit CCTV Camera';
                    content = getCCTVEditForm(item);
                    break;
                    
                case 'user':
                    item = users.find(u => u.username === id);
                    if (!item) return;
                    if (id === 'av_5637') {
                        showToast('Cannot edit the main administrator account');
                        return;
                    }
                    title = 'Edit User';
                    content = getUserEditForm(item);
                    break;
                    
                default:
                    return;
            }
            
            currentEditItem = item;
            currentDataType = type;
            
            document.getElementById('edit-modal-title').textContent = title;
            document.getElementById('edit-modal-content').innerHTML = content;
            
            // Setup image upload for edit forms
            if (type === 'vehicle' || type === 'shop' || type === 'boat' || type === 'cctv') {
                setTimeout(() => {
                    const editImageUpload = document.getElementById('edit-image-upload');
                    const editImagePreview = document.getElementById('edit-image-preview');
                    
                    if (editImageUpload) {
                        editImageUpload.addEventListener('change', (e) => {
                            const file = e.target.files[0];
                            if (file) {
                                const reader = new FileReader();
                                reader.onload = (event) => {
                                    editImagePreview.innerHTML = `<img src="${event.target.result}" alt="New Image">`;
                                };
                                reader.readAsDataURL(file);
                            }
                        });
                    }
                }, 100);
            }
            
            showModal(document.getElementById('edit-data-modal'));
        }
        
        // Get task edit form
        function getTaskEditForm(task) {
            return `
                <div class="form-group">
                    <label for="edit-task-island">Select Island</label>
                    <select id="edit-task-island">
                        <option value="F.Feeali" ${task.island === 'F.Feeali' ? 'selected' : ''}>F.Feeali</option>
                        <option value="F.Bilehdhoo" ${task.island === 'F.Bilehdhoo' ? 'selected' : ''}>F.Bilehdhoo</option>
                        <option value="F.Dharaboodhoo" ${task.island === 'F.Dharaboodhoo' ? 'selected' : ''}>F.Dharaboodhoo</option>
                        <option value="F.Magoodhoo" ${task.island === 'F.Magoodhoo' ? 'selected' : ''}>F.Magoodhoo</option>
                        <option value="F.Nilandhoo" ${task.island === 'F.Nilandhoo' ? 'selected' : ''}>F.Nilandhoo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-task-service-number">Officer Service Number</label>
                    <input type="text" id="edit-task-service-number" value="${escapeHtml(task.serviceNumber || '')}" placeholder="Enter officer service number">
                </div>
                
                <div class="form-group">
                    <label>Task Message</label>
                    <div class="language-tabs">
                        <button type="button" class="language-tab active" data-lang="en">English</button>
                        <button type="button" class="language-tab" data-lang="dv">Dhivehi</button>
                    </div>
                    <div id="edit-task-message-en" class="message-container active">
                        <textarea id="edit-task-message-en" placeholder="Enter task message in English...">${escapeHtml(task.messageEn || '')}</textarea>
                    </div>
                    <div id="edit-task-message-dv" class="message-container">
                        <textarea id="edit-task-message-dv" class="dhivehi-input" placeholder="  ...">${escapeHtml(task.messageDv || '')}</textarea>
                    </div>
                </div>
            `;
        }
        
        // Get operation edit form
        function getOperationEditForm(operation) {
            return `
                <div class="form-group">
                    <label for="edit-operation-island">Select Island</label>
                    <select id="edit-operation-island">
                        <option value="F.Feeali" ${operation.island === 'F.Feeali' ? 'selected' : ''}>F.Feeali</option>
                        <option value="F.Bilehdhoo" ${operation.island === 'F.Bilehdhoo' ? 'selected' : ''}>F.Bilehdhoo</option>
                        <option value="F.Dharaboodhoo" ${operation.island === 'F.Dharaboodhoo' ? 'selected' : ''}>F.Dharaboodhoo</option>
                        <option value="F.Magoodhoo" ${operation.island === 'F.Magoodhoo' ? 'selected' : ''}>F.Magoodhoo</option>
                        <option value="F.Nilandhoo" ${operation.island === 'F.Nilandhoo' ? 'selected' : ''}>F.Nilandhoo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-operation-service-number">Officer Service Number</label>
                    <input type="text" id="edit-operation-service-number" value="${escapeHtml(operation.serviceNumber || '')}" placeholder="Enter officer service number">
                </div>
                
                <div class="form-group">
                    <label>Operation Message</label>
                    <div class="language-tabs">
                        <button type="button" class="language-tab active" data-lang="en">English</button>
                        <button type="button" class="language-tab" data-lang="dv">Dhivehi</button>
                    </div>
                    <div id="edit-operation-message-en" class="message-container active">
                        <textarea id="edit-operation-message-en" placeholder="Enter operation message in English...">${escapeHtml(operation.messageEn || '')}</textarea>
                    </div>
                    <div id="edit-operation-message-dv" class="message-container">
                        <textarea id="edit-operation-message-dv" class="dhivehi-input" placeholder="  ...">${escapeHtml(operation.messageDv || '')}</textarea>
                    </div>
                </div>
            `;
        }
        
        // Get location edit form
        function getLocationEditForm(location) {
            return `
                <div class="form-group">
                    <label for="edit-location-island">Select Island</label>
                    <select id="edit-location-island">
                        <option value="F.Feeali" ${location.island === 'F.Feeali' ? 'selected' : ''}>F.Feeali</option>
                        <option value="F.Bilehdhoo" ${location.island === 'F.Bilehdhoo' ? 'selected' : ''}>F.Bilehdhoo</option>
                        <option value="F.Dharaboodhoo" ${location.island === 'F.Dharaboodhoo' ? 'selected' : ''}>F.Dharaboodhoo</option>
                        <option value="F.Magoodhoo" ${location.island === 'F.Magoodhoo' ? 'selected' : ''}>F.Magoodhoo</option>
                        <option value="F.Nilandhoo" ${location.island === 'F.Nilandhoo' ? 'selected' : ''}>F.Nilandhoo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-location-name">Location Name</label>
                    <input type="text" id="edit-location-name" value="${escapeHtml(location.locationName || '')}" placeholder="Enter location name">
                </div>
                
                <div class="form-group">
                    <label for="edit-location-remarks">Remarks Message</label>
                    <textarea id="edit-location-remarks" placeholder="Enter remarks about this location...">${escapeHtml(location.remarks || '')}</textarea>
                </div>
            `;
        }
        
        // Get vehicle edit form
        function getVehicleEditForm(vehicle) {
            return `
                <div class="form-group">
                    <label for="edit-vehicle-island">Select Island</label>
                    <select id="edit-vehicle-island">
                        <option value="">-- Select island --</option>
                        <option value="F.Feeali" ${vehicle.island === 'F.Feeali' ? 'selected' : ''}>F.Feeali</option>
                        <option value="F.Bilehdhoo" ${vehicle.island === 'F.Bilehdhoo' ? 'selected' : ''}>F.Bilehdhoo</option>
                        <option value="F.Dharaboodhoo" ${vehicle.island === 'F.Dharaboodhoo' ? 'selected' : ''}>F.Dharaboodhoo</option>
                        <option value="F.Magoodhoo" ${vehicle.island === 'F.Magoodhoo' ? 'selected' : ''}>F.Magoodhoo</option>
                        <option value="F.Nilandhoo" ${vehicle.island === 'F.Nilandhoo' ? 'selected' : ''}>F.Nilandhoo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-vehicle-type">Vehicle Type</label>
                    <select id="edit-vehicle-type">
                        <option value="">-- Select type --</option>
                        <option value="Car" ${vehicle.type === 'Car' ? 'selected' : ''}>Car</option>
                        <option value="Motorcycle" ${vehicle.type === 'Motorcycle' ? 'selected' : ''}>Motorcycle</option>
                        <option value="Van" ${vehicle.type === 'Van' ? 'selected' : ''}>Van</option>
                        <option value="Pickup Truck" ${vehicle.type === 'Pickup Truck' ? 'selected' : ''}>Pickup Truck</option>
                        <option value="Truck" ${vehicle.type === 'Truck' ? 'selected' : ''}>Truck</option>
                        <option value="Bus" ${vehicle.type === 'Bus' ? 'selected' : ''}>Bus</option>
                        <option value="Other" ${vehicle.type === 'Other' ? 'selected' : ''}>Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-vehicle-legal-owner">Legal Owner</label>
                    <input type="text" id="edit-vehicle-legal-owner" value="${escapeHtml(vehicle.legalOwner || '')}" placeholder="Enter legal owner name">
                </div>
                
                <div class="form-group">
                    <label for="edit-vehicle-beneficial-owner">Beneficial Owner</label>
                    <input type="text" id="edit-vehicle-beneficial-owner" value="${escapeHtml(vehicle.beneficialOwner || '')}" placeholder="Enter beneficial owner name">
                </div>
                
                <div class="form-group">
                    <label for="edit-vehicle-number">Vehicle Number</label>
                    <input type="text" id="edit-vehicle-number" value="${escapeHtml(vehicle.number || '')}" placeholder="e.g., A-1234">
                </div>
                
                <div class="form-group">
                    <label for="edit-vehicle-owner-contact">Owner Contact</label>
                    <input type="text" id="edit-vehicle-owner-contact" value="${escapeHtml(vehicle.contact || '')}" placeholder="e.g., 1234567">
                </div>
                
                <div class="form-group">
                    <label>Vehicle Image</label>
                    <div class="image-preview-container" onclick="document.getElementById('edit-image-upload').click()">
                        <div id="edit-image-preview" class="image-preview">
                            ${vehicle.image ? `<img src="${vehicle.image}" alt="Current Image">` : '<span class="plus-sign">+</span>'}
                        </div>
                        <input type="file" id="edit-image-upload" accept="image/*" class="d-none">
                    </div>
                    <small class="text-muted">Click to upload new image (optional)</small>
                </div>
                
                <div class="form-group">
                    <label for="edit-vehicle-notes">Additional Notes</label>
                    <textarea id="edit-vehicle-notes" placeholder="Any additional information about the vehicle..." rows="2">${escapeHtml(vehicle.notes || '')}</textarea>
                </div>
            `;
        }
        
        // Get shop edit form
        function getShopEditForm(shop) {
            return `
                <div class="form-group">
                    <label for="edit-shop-island">Select Island</label>
                    <select id="edit-shop-island">
                        <option value="">-- Select island --</option>
                        <option value="F.Feeali" ${shop.island === 'F.Feeali' ? 'selected' : ''}>F.Feeali</option>
                        <option value="F.Bilehdhoo" ${shop.island === 'F.Bilehdhoo' ? 'selected' : ''}>F.Bilehdhoo</option>
                        <option value="F.Dharaboodhoo" ${shop.island === 'F.Dharaboodhoo' ? 'selected' : ''}>F.Dharaboodhoo</option>
                        <option value="F.Magoodhoo" ${shop.island === 'F.Magoodhoo' ? 'selected' : ''}>F.Magoodhoo</option>
                        <option value="F.Nilandhoo" ${shop.island === 'F.Nilandhoo' ? 'selected' : ''}>F.Nilandhoo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-shop-name">Shop Name</label>
                    <input type="text" id="edit-shop-name" value="${escapeHtml(shop.name || '')}" placeholder="e.g., Island Supermarket">
                </div>
                
                <div class="form-group">
                    <label for="edit-shop-owner">Owner Name</label>
                    <input type="text" id="edit-shop-owner" value="${escapeHtml(shop.owner || '')}" placeholder="Enter owner full name">
                </div>
                
                <div class="form-group">
                    <label for="edit-shop-owner-id">Owner ID Number</label>
                    <input type="text" id="edit-shop-owner-id" value="${escapeHtml(shop.ownerId || '')}" placeholder="ID card number">
                </div>
                
                <div class="form-group">
                    <label for="edit-shop-contact">Contact Number</label>
                    <input type="text" id="edit-shop-contact" value="${escapeHtml(shop.contact || '')}" placeholder="e.g., 1234567">
                </div>
                
                <div class="form-group">
                    <label for="edit-shop-location">Shop Location</label>
                    <input type="text" id="edit-shop-location" value="${escapeHtml(shop.location || '')}" placeholder="e.g., Main Street (optional)">
                </div>
                
                <div class="form-group">
                    <label for="edit-shop-description">Shop Description / Type</label>
                    <select id="edit-shop-description">
                        <option value="">-- Select type --</option>
                        <option value="Supermarket" ${shop.description === 'Supermarket' ? 'selected' : ''}>Supermarket</option>
                        <option value="Cafe/Restaurant" ${shop.description === 'Cafe/Restaurant' ? 'selected' : ''}>Cafe/Restaurant</option>
                        <option value="Electronics" ${shop.description === 'Electronics' ? 'selected' : ''}>Electronics Store</option>
                        <option value="Clothing" ${shop.description === 'Clothing' ? 'selected' : ''}>Clothing Store</option>
                        <option value="Hardware" ${shop.description === 'Hardware' ? 'selected' : ''}>Hardware Store</option>
                        <option value="Pharmacy" ${shop.description === 'Pharmacy' ? 'selected' : ''}>Pharmacy</option>
                        <option value="Other" ${shop.description === 'Other' ? 'selected' : ''}>Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="edit-shop-cctv-available" ${shop.cctvAvailable ? 'checked' : ''}>
                        <i class="fas fa-video"></i> CCTV Available at this shop
                    </label>
                </div>
                
                <div class="form-group">
                    <label>Shop Image</label>
                    <div class="image-preview-container" onclick="document.getElementById('edit-image-upload').click()">
                        <div id="edit-image-preview" class="image-preview">
                            ${shop.image ? `<img src="${shop.image}" alt="Current Image">` : '<span class="plus-sign">+</span>'}
                        </div>
                        <input type="file" id="edit-image-upload" accept="image/*" class="d-none">
                    </div>
                    <small class="text-muted">Click to upload new image (optional)</small>
                </div>
            `;
        }
        
        // Get boat edit form
        function getBoatEditForm(boat) {
            return `
                <div class="form-group">
                    <label for="edit-boat-island">Select Island</label>
                    <select id="edit-boat-island">
                        <option value="">-- Select island --</option>
                        <option value="F.Feeali" ${boat.island === 'F.Feeali' ? 'selected' : ''}>F.Feeali</option>
                        <option value="F.Bilehdhoo" ${boat.island === 'F.Bilehdhoo' ? 'selected' : ''}>F.Bilehdhoo</option>
                        <option value="F.Dharaboodhoo" ${boat.island === 'F.Dharaboodhoo' ? 'selected' : ''}>F.Dharaboodhoo</option>
                        <option value="F.Magoodhoo" ${boat.island === 'F.Magoodhoo' ? 'selected' : ''}>F.Magoodhoo</option>
                        <option value="F.Nilandhoo" ${boat.island === 'F.Nilandhoo' ? 'selected' : ''}>F.Nilandhoo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-boat-type">Vessel Type</label>
                    <select id="edit-boat-type">
                        <option value="">-- Select type --</option>
                        <option value="Speedboat" ${boat.type === 'Speedboat' ? 'selected' : ''}>Speedboat</option>
                        <option value="Fishing Boat" ${boat.type === 'Fishing Boat' ? 'selected' : ''}>Fishing Boat</option>
                        <option value="Dinghy" ${boat.type === 'Dinghy' ? 'selected' : ''}>Dinghy</option>
                        <option value="Cargo Boat" ${boat.type === 'Cargo Boat' ? 'selected' : ''}>Cargo Boat</option>
                        <option value="Passenger Ferry" ${boat.type === 'Passenger Ferry' ? 'selected' : ''}>Passenger Ferry</option>
                        <option value="Other" ${boat.type === 'Other' ? 'selected' : ''}>Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-boat-name">Vessel Name</label>
                    <input type="text" id="edit-boat-name" value="${escapeHtml(boat.name || '')}" placeholder="e.g., Island Voyager">
                </div>
                
                <div class="form-group">
                    <label for="edit-boat-owner">Owner Name</label>
                    <input type="text" id="edit-boat-owner" value="${escapeHtml(boat.owner || '')}" placeholder="Enter owner full name">
                </div>
                
                <div class="form-group">
                    <label for="edit-boat-owner-id">Owner ID Number</label>
                    <input type="text" id="edit-boat-owner-id" value="${escapeHtml(boat.ownerId || '')}" placeholder="ID card number">
                </div>
                
                <div class="form-group">
                    <label for="edit-boat-contact">Contact Number</label>
                    <input type="text" id="edit-boat-contact" value="${escapeHtml(boat.contact || '')}" placeholder="e.g., 1234567">
                </div>
                
                <div class="form-group">
                    <label for="edit-boat-reg-number">Registration Number</label>
                    <input type="text" id="edit-boat-reg-number" value="${escapeHtml(boat.regNumber || '')}" placeholder="Vessel registration number">
                </div>
                
                <div class="form-group">
                    <label for="edit-boat-capacity">Capacity (Persons)</label>
                    <input type="number" id="edit-boat-capacity" value="${escapeHtml(boat.capacity || '')}" placeholder="e.g., 10" min="1">
                </div>
                
                <div class="form-group">
                    <label>Vessel Image</label>
                    <div class="image-preview-container" onclick="document.getElementById('edit-image-upload').click()">
                        <div id="edit-image-preview" class="image-preview">
                            ${boat.image ? `<img src="${boat.image}" alt="Current Image">` : '<span class="plus-sign">+</span>'}
                        </div>
                        <input type="file" id="edit-image-upload" accept="image/*" class="d-none">
                    </div>
                    <small class="text-muted">Click to upload new image (optional)</small>
                </div>
            `;
        }
        
        // Get CCTV edit form
        function getCCTVEditForm(cctv) {
            return `
                <div class="form-group">
                    <label for="edit-cctv-island">Select Island</label>
                    <select id="edit-cctv-island">
                        <option value="">-- Select island --</option>
                        <option value="F.Feeali" ${cctv.island === 'F.Feeali' ? 'selected' : ''}>F.Feeali</option>
                        <option value="F.Bilehdhoo" ${cctv.island === 'F.Bilehdhoo' ? 'selected' : ''}>F.Bilehdhoo</option>
                        <option value="F.Dharaboodhoo" ${cctv.island === 'F.Dharaboodhoo' ? 'selected' : ''}>F.Dharaboodhoo</option>
                        <option value="F.Magoodhoo" ${cctv.island === 'F.Magoodhoo' ? 'selected' : ''}>F.Magoodhoo</option>
                        <option value="F.Nilandhoo" ${cctv.island === 'F.Nilandhoo' ? 'selected' : ''}>F.Nilandhoo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-cctv-location-type">Location Type</label>
                    <select id="edit-cctv-location-type">
                        <option value="">-- Select location type --</option>
                        <option value="House" ${cctv.locationType === 'House' ? 'selected' : ''}>House</option>
                        <option value="Road" ${cctv.locationType === 'Road' ? 'selected' : ''}>Road</option>
                        <option value="Shop" ${cctv.locationType === 'Shop' ? 'selected' : ''}>Shop</option>
                        <option value="Gov Office" ${cctv.locationType === 'Gov Office' ? 'selected' : ''}>Government Office</option>
                        <option value="Pvt Office" ${cctv.locationType === 'Pvt Office' ? 'selected' : ''}>Private Office</option>
                        <option value="Harbor" ${cctv.locationType === 'Harbor' ? 'selected' : ''}>Harbor</option>
                        <option value="School" ${cctv.locationType === 'School' ? 'selected' : ''}>School</option>
                        <option value="Health Center" ${cctv.locationType === 'Health Center' ? 'selected' : ''}>Health Center</option>
                        <option value="Mosque" ${cctv.locationType === 'Mosque' ? 'selected' : ''}>Mosque</option>
                        <option value="Other" ${cctv.locationType === 'Other' ? 'selected' : ''}>Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="edit-cctv-location-name">Location Name / Address</label>
                    <input type="text" id="edit-cctv-location-name" value="${escapeHtml(cctv.locationName || '')}" placeholder="e.g., Main Street, Island Supermarket, Police Station">
                </div>
                
                <div class="form-group">
                    <label for="edit-cctv-area-name">CCTV Area Name (Optional)</label>
                    <input type="text" id="edit-cctv-area-name" value="${escapeHtml(cctv.areaName || '')}" placeholder="e.g., Entrance Camera, Parking Area, Main Gate">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-cctv-installation-date">Installation Date</label>
                        <input type="date" id="edit-cctv-installation-date" value="${cctv.installationDate || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-cctv-status">Camera Status</label>
                        <select id="edit-cctv-status">
                            <option value="active" ${cctv.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="inactive" ${cctv.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                            <option value="maintenance" ${cctv.status === 'maintenance' ? 'selected' : ''}>Under Maintenance</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-cctv-notes">Additional Notes</label>
                    <textarea id="edit-cctv-notes" placeholder="Any additional information about the CCTV camera..." rows="2">${escapeHtml(cctv.notes || '')}</textarea>
                </div>
                
                <div class="form-group">
                    <label>CCTV Location Image</label>
                    <div class="image-preview-container" onclick="document.getElementById('edit-image-upload').click()">
                        <div id="edit-image-preview" class="image-preview">
                            ${cctv.image ? `<img src="${cctv.image}" alt="Current Image">` : '<span class="plus-sign">+</span>'}
                        </div>
                        <input type="file" id="edit-image-upload" accept="image/*" class="d-none">
                    </div>
                    <small class="text-muted">Click to upload new image (optional)</small>
                </div>
            `;
        }
        
        // Get user edit form
        function getUserEditForm(user) {
            return `
                <div class="form-group">
                    <label for="edit-username">Username</label>
                    <input type="text" id="edit-username" value="${escapeHtml(user.username)}" readonly>
                </div>
                <div class="form-group">
                    <label for="edit-password">Password</label>
                    <input type="password" id="edit-password" placeholder="Leave blank to keep current password">
                </div>
                <div class="form-group">
                    <label for="edit-fullname">Full Name</label>
                    <input type="text" id="edit-fullname" value="${escapeHtml(user.fullName || '')}">
                </div>
                <div class="form-group">
                    <label for="edit-role">Role</label>
                    <select id="edit-role">
                        <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Administrator</option>
                        <option value="user" ${user.role === 'user' ? 'selected' : ''}>Regular User</option>
                        <option value="viewer" ${user.role === 'viewer' ? 'selected' : ''}>Viewer (Read Only)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="edit-user-active" ${user.isActive ? 'checked' : ''}> Active Account
                    </label>
                </div>
            `;
        }
        
        // Save edit
        async function saveEdit() {
            if (!currentEditItem || !currentDataType) return;
            
            if (!isAdmin) {
                showToast('Only av_5637 can edit items');
                return;
            }
            
            try {
                let updates = {};
                let refPath = '';
                
                switch(currentDataType) {
                    case 'task':
                        const taskId = currentEditItem.id;
                        const island = document.getElementById('edit-task-island').value;
                        const serviceNumber = document.getElementById('edit-task-service-number').value.trim();
                        const messageEn = document.getElementById('edit-task-message-en').value.trim();
                        const messageDv = document.getElementById('edit-task-message-dv').value.trim();
                        
                        if (!island || !serviceNumber || (!messageEn && !messageDv)) {
                            showToast('Please fill in all required fields');
                            return;
                        }
                        
                        updates = {
                            island: island,
                            serviceNumber: serviceNumber,
                            messageEn: messageEn,
                            messageDv: messageDv,
                            updatedAt: new Date().toISOString(),
                            updatedBy: currentUser.username
                        };
                        
                        refPath = `taskLogs/${taskId}`;
                        break;
                        
                    case 'operation':
                        const operationId = currentEditItem.id;
                        const opIsland = document.getElementById('edit-operation-island').value;
                        const opServiceNumber = document.getElementById('edit-operation-service-number').value.trim();
                        const opMessageEn = document.getElementById('edit-operation-message-en').value.trim();
                        const opMessageDv = document.getElementById('edit-operation-message-dv').value.trim();
                        
                        if (!opIsland || !opServiceNumber || (!opMessageEn && !opMessageDv)) {
                            showToast('Please fill in all required fields');
                            return;
                        }
                        
                        updates = {
                            island: opIsland,
                            serviceNumber: opServiceNumber,
                            messageEn: opMessageEn,
                            messageDv: opMessageDv,
                            updatedAt: new Date().toISOString(),
                            updatedBy: currentUser.username
                        };
                        
                        refPath = `operationLogs/${operationId}`;
                        break;
                        
                    case 'location':
                        const locationId = currentEditItem.id;
                        const locIsland = document.getElementById('edit-location-island').value;
                        const locationName = document.getElementById('edit-location-name').value.trim();
                        const remarks = document.getElementById('edit-location-remarks').value.trim();
                        
                        if (!locIsland || !locationName || !remarks) {
                            showToast('Please fill in all required fields');
                            return;
                        }
                        
                        updates = {
                            island: locIsland,
                            locationName: locationName,
                            remarks: remarks,
                            updatedAt: new Date().toISOString(),
                            updatedBy: currentUser.username
                        };
                        
                        refPath = `locationLogs/${locationId}`;
                        break;
                        
                    case 'vehicle':
                        const vehicleId = currentEditItem.id;
                        const vehIsland = document.getElementById('edit-vehicle-island').value;
                        const vehType = document.getElementById('edit-vehicle-type').value;
                        const legalOwner = document.getElementById('edit-vehicle-legal-owner').value.trim();
                        const beneficialOwner = document.getElementById('edit-vehicle-beneficial-owner').value.trim();
                        const vehNumber = document.getElementById('edit-vehicle-number').value.trim();
                        const vehContact = document.getElementById('edit-vehicle-owner-contact').value.trim();
                        const vehNotes = document.getElementById('edit-vehicle-notes').value.trim();
                        
                        if (!vehIsland || !vehType || !legalOwner || !beneficialOwner || !vehNumber || !vehContact) {
                            showToast('Please fill in all required fields');
                            return;
                        }
                        
                        updates = {
                            island: vehIsland,
                            type: vehType,
                            legalOwner: legalOwner,
                            beneficialOwner: beneficialOwner,
                            number: vehNumber,
                            contact: vehContact,
                            notes: vehNotes,
                            updatedAt: new Date().toISOString(),
                            updatedBy: currentUser.username
                        };
                        
                        // Handle image update
                        const vehImageInput = document.getElementById('edit-image-upload');
                        if (vehImageInput.files && vehImageInput.files[0]) {
                            const reader = new FileReader();
                            reader.onload = async function(event) {
                                updates.image = event.target.result;
                                await database.ref(`vehicles/${vehicleId}`).update(updates);
                                hideModal(document.getElementById('edit-data-modal'));
                                loadVehicles();
                                showToast('Vehicle updated successfully');
                            };
                            reader.readAsDataURL(vehImageInput.files[0]);
                            return; // Return early to wait for image read
                        }
                        
                        refPath = `vehicles/${vehicleId}`;
                        break;
                        
                    case 'shop':
                        const shopId = currentEditItem.id;
                        const shopIsland = document.getElementById('edit-shop-island').value;
                        const shopName = document.getElementById('edit-shop-name').value.trim();
                        const shopOwner = document.getElementById('edit-shop-owner').value.trim();
                        const shopOwnerId = document.getElementById('edit-shop-owner-id').value.trim();
                        const shopContact = document.getElementById('edit-shop-contact').value.trim();
                        const shopLocation = document.getElementById('edit-shop-location').value.trim();
                        const shopDescription = document.getElementById('edit-shop-description').value;
                        const shopCCTVAvailable = document.getElementById('edit-shop-cctv-available').checked;
                        
                        if (!shopIsland || !shopName || !shopOwner || !shopOwnerId || !shopContact || !shopDescription) {
                            showToast('Please fill in all required fields');
                            return;
                        }
                        
                        updates = {
                            island: shopIsland,
                            name: shopName,
                            owner: shopOwner,
                            ownerId: shopOwnerId,
                            contact: shopContact,
                            location: shopLocation,
                            description: shopDescription,
                            cctvAvailable: shopCCTVAvailable,
                            updatedAt: new Date().toISOString(),
                            updatedBy: currentUser.username
                        };
                        
                        // Handle image update
                        const shopImageInput = document.getElementById('edit-image-upload');
                        if (shopImageInput.files && shopImageInput.files[0]) {
                            const reader = new FileReader();
                            reader.onload = async function(event) {
                                updates.image = event.target.result;
                                await database.ref(`shops/${shopId}`).update(updates);
                                hideModal(document.getElementById('edit-data-modal'));
                                loadShops();
                                showToast('Shop updated successfully');
                            };
                            reader.readAsDataURL(shopImageInput.files[0]);
                            return;
                        }
                        
                        refPath = `shops/${shopId}`;
                        break;
                        
                    case 'boat':
                        const boatId = currentEditItem.id;
                        const boatIsland = document.getElementById('edit-boat-island').value;
                        const boatType = document.getElementById('edit-boat-type').value;
                        const boatName = document.getElementById('edit-boat-name').value.trim();
                        const boatOwner = document.getElementById('edit-boat-owner').value.trim();
                        const boatOwnerId = document.getElementById('edit-boat-owner-id').value.trim();
                        const boatContact = document.getElementById('edit-boat-contact').value.trim();
                        const boatRegNumber = document.getElementById('edit-boat-reg-number').value.trim();
                        const boatCapacity = document.getElementById('edit-boat-capacity').value.trim();
                        
                        if (!boatIsland || !boatType || !boatName || !boatOwner || !boatOwnerId || !boatContact || !boatRegNumber || !boatCapacity) {
                            showToast('Please fill in all required fields');
                            return;
                        }
                        
                        updates = {
                            island: boatIsland,
                            type: boatType,
                            name: boatName,
                            owner: boatOwner,
                            ownerId: boatOwnerId,
                            contact: boatContact,
                            regNumber: boatRegNumber,
                            capacity: boatCapacity,
                            updatedAt: new Date().toISOString(),
                            updatedBy: currentUser.username
                        };
                        
                        // Handle image update
                        const boatImageInput = document.getElementById('edit-image-upload');
                        if (boatImageInput.files && boatImageInput.files[0]) {
                            const reader = new FileReader();
                            reader.onload = async function(event) {
                                updates.image = event.target.result;
                                await database.ref(`boats/${boatId}`).update(updates);
                                hideModal(document.getElementById('edit-data-modal'));
                                loadBoats();
                                showToast('Boat updated successfully');
                            };
                            reader.readAsDataURL(boatImageInput.files[0]);
                            return;
                        }
                        
                        refPath = `boats/${boatId}`;
                        break;
                        
                    case 'cctv':
                        const cctvId = currentEditItem.id;
                        const cctvIsland = document.getElementById('edit-cctv-island').value;
                        const cctvLocationType = document.getElementById('edit-cctv-location-type').value;
                        const cctvLocationName = document.getElementById('edit-cctv-location-name').value.trim();
                        const cctvAreaName = document.getElementById('edit-cctv-area-name').value.trim();
                        const cctvInstallationDate = document.getElementById('edit-cctv-installation-date').value;
                        const cctvStatus = document.getElementById('edit-cctv-status').value;
                        const cctvNotes = document.getElementById('edit-cctv-notes').value.trim();
                        
                        if (!cctvIsland || !cctvLocationType || !cctvLocationName || !cctvStatus) {
                            showToast('Please fill in all required fields');
                            return;
                        }
                        
                        updates = {
                            island: cctvIsland,
                            locationType: cctvLocationType,
                            locationName: cctvLocationName,
                            areaName: cctvAreaName,
                            installationDate: cctvInstallationDate,
                            status: cctvStatus,
                            notes: cctvNotes,
                            updatedAt: new Date().toISOString(),
                            updatedBy: currentUser.username
                        };
                        
                        // Handle image update
                        const cctvImageInput = document.getElementById('edit-image-upload');
                        if (cctvImageInput.files && cctvImageInput.files[0]) {
                            const reader = new FileReader();
                            reader.onload = async function(event) {
                                updates.image = event.target.result;
                                await database.ref(`cctv/${cctvId}`).update(updates);
                                hideModal(document.getElementById('edit-data-modal'));
                                loadCCTVItems();
                                showToast('CCTV camera updated successfully');
                            };
                            reader.readAsDataURL(cctvImageInput.files[0]);
                            return;
                        }
                        
                        refPath = `cctv/${cctvId}`;
                        break;
                        
                    case 'user':
                        const username = currentEditItem.username;
                        const password = document.getElementById('edit-password').value.trim();
                        const fullName = document.getElementById('edit-fullname').value.trim();
                        const role = document.getElementById('edit-role').value;
                        const isActive = document.getElementById('edit-user-active').checked;
                        
                        updates = {
                            fullName: fullName,
                            role: role,
                            isActive: isActive,
                            updatedAt: new Date().toISOString(),
                            updatedBy: currentUser.username
                        };
                        
                        if (password) {
                            updates.password = password;
                        }
                        
                        refPath = `users/${username}`;
                        break;
                        
                    default:
                        return;
                }
                
                await database.ref(refPath).update(updates);
                
                hideModal(document.getElementById('edit-data-modal'));
                
                // Refresh the appropriate data
                switch(currentDataType) {
                    case 'task':
                        loadTaskLogs();
                        break;
                    case 'operation':
                        loadOperationLogs();
                        break;
                    case 'location':
                        loadLocationLogs();
                        break;
                    case 'vehicle':
                        loadVehicles();
                        break;
                    case 'shop':
                        loadShops();
                        break;
                    case 'boat':
                        loadBoats();
                        break;
                    case 'cctv':
                        loadCCTVItems();
                        break;
                    case 'user':
                        loadUsers();
                        break;
                }
                
                showToast('Item updated successfully');
                
            } catch (error) {
                console.error('Error saving edit:', error);
                showToast('Error saving changes');
            }
        }
        
             
        
        // Confirm delete
        async function confirmDelete() {
            if (!currentDeleteItem || !currentDataType) return;
            
            if (!isAdmin) {
                showToast('Only av_5637 can delete items');
                hideModal(document.getElementById('delete-modal'));
                return;
            }
            
            try {
                let refPath = '';
                
                switch(currentDataType) {
                    case 'task':
                        refPath = `taskLogs/${currentDeleteItem}`;
                        break;
                    case 'operation':
                        refPath = `operationLogs/${currentDeleteItem}`;
                        break;
                    case 'location':
                        refPath = `locationLogs/${currentDeleteItem}`;
                        break;
                    case 'vehicle':
                        refPath = `vehicles/${currentDeleteItem}`;
                        break;
                    case 'shop':
                        refPath = `shops/${currentDeleteItem}`;
                        break;
                    case 'boat':
                        refPath = `boats/${currentDeleteItem}`;
                        break;
                    case 'cctv':
                        refPath = `cctv/${currentDeleteItem}`;
                        break;
                    case 'user':
                        refPath = `users/${currentDeleteItem}`;
                        break;
                }
                
                await database.ref(refPath).remove();
                
                hideModal(document.getElementById('delete-modal'));
                
                // Refresh the appropriate data
                switch(currentDataType) {
                    case 'task':
                        loadTaskLogs();
                        break;
                    case 'operation':
                        loadOperationLogs();
                        break;
                    case 'location':
                        loadLocationLogs();
                        break;
                    case 'vehicle':
                        loadVehicles();
                        break;
                    case 'shop':
                        loadShops();
                        break;
                    case 'boat':
                        loadBoats();
                        break;
                    case 'cctv':
                        loadCCTVItems();
                        break;
                    case 'user':
                        loadUsers();
                        break;
                }
                
                showToast('Item deleted successfully');
                
            } catch (error) {
                console.error('Error deleting item:', error);
                showToast('Error deleting item');
            }
        }
        
        // Mark item for monitoring
        async function markForMonitoring(type, itemId, issueType, issueNote) {
            let item, name, owner, contact, island, image = null;
            
            switch(type) {
                case 'vehicle':
                    const vehicle = vehicles.find(v => v.id === itemId);
                    if (!vehicle) {
                        showToast('Vehicle not found');
                        return;
                    }
                    item = vehicle;
                    name = `${vehicle.type} - ${vehicle.number}`;
                    owner = vehicle.legalOwner;
                    contact = vehicle.contact;
                    island = vehicle.island;
                    image = vehicle.image;
                    
                    // Update vehicle status
                    await database.ref(`vehicles/${itemId}`).update({
                        status: issueType
                    });
                    break;
                    
                case 'shop':
                    const shop = shops.find(s => s.id === itemId);
                    if (!shop) {
                        showToast('Shop not found');
                        return;
                    }
                    item = shop;
                    name = shop.name;
                    owner = shop.owner;
                    contact = shop.contact;
                    island = shop.island;
                    image = shop.image;
                    break;
                    
                case 'boat':
                    const boat = boats.find(b => b.id === itemId);
                    if (!boat) {
                        showToast('Vessel not found');
                        return;
                    }
                    item = boat;
                    name = `${boat.type} - ${boat.name}`;
                    owner = boat.owner;
                    contact = boat.contact;
                    island = boat.island;
                    image = boat.image;
                    break;
                    
                case 'cctv':
                    const cctv = cctvItems.find(c => c.id === itemId);
                    if (!cctv) {
                        showToast('CCTV camera not found');
                        return;
                    }
                    item = cctv;
                    name = cctv.locationName;
                    owner = 'N/A';
                    contact = 'N/A';
                    island = cctv.island;
                    image = cctv.image;
                    break;
                    
                default:
                    return;
            }
            
            // Check if already in monitoring
            const monitoringSnapshot = await database.ref('monitoring').orderByChild('itemId').equalTo(itemId).once('value');
            if (monitoringSnapshot.exists()) {
                showToast('This item is already marked for monitoring');
                return;
            }
            
            const monitoringData = {
                type: type,
                itemId: itemId,
                name: name,
                owner: owner,
                contact: contact,
                island: island,
                image: image,
                issueType: issueType,
                issueNote: issueNote,
                markedBy: currentUser.username,
                markedAt: new Date().toISOString()
            };
            
            try {
                await database.ref('monitoring').push(monitoringData);
                showToast('Item marked for monitoring');
                
                // Reload monitoring items
                loadMonitoringItems();
            } catch (error) {
                console.error('Error marking for monitoring:', error);
                showToast('Error marking item for monitoring');
            }
        }
        
        // Remove from monitoring
        async function removeFromMonitoring(monitoringId, type, itemId) {
            if (!isAdmin) {
                showToast('Only av_5637 can remove items from monitoring');
                return;
            }
            
            try {
                // Remove from monitoring
                await database.ref(`monitoring/${monitoringId}`).remove();
                
                // Reset vehicle status if applicable
                if (type === 'vehicle') {
                    await database.ref(`vehicles/${itemId}`).update({
                        status: 'normal'
                    });
                    loadVehicles();
                }
                
                showToast('Item removed from monitoring');
                loadMonitoringItems();
                
            } catch (error) {
                console.error('Error removing from monitoring:', error);
                showToast('Error removing item from monitoring');
            }
        }
        
        // Copy text to clipboard
        function copyText(text, type) {
            if (!text || text.trim() === '') {
                showToast('No text to copy');
                return;
            }
            
            navigator.clipboard.writeText(text)
                .then(() => {
                    showToast(`${type} copied to clipboard`);
                })
                .catch(err => {
                    console.error('Failed to copy text: ', err);
                    showToast('Failed to copy text');
                });
        }
        
        // View image in modal
        function viewImage(imageSrc, title) {
            document.getElementById('modalImage').src = imageSrc;
            document.getElementById('imageModalTitle').textContent = title;
            const imageModal = new bootstrap.Modal(document.getElementById('imageModal'));
            imageModal.show();
        }
        
        // Export to PDF
        function exportToPDF(type) {
            if (typeof jsPDF === 'undefined') {
                showToast('PDF library not loaded');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 10;
            let yPos = margin;
            
            // Header
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('Faafu Atoll Island Log System', pageWidth / 2, yPos, { align: 'center' });
            yPos += 8;
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text('Official Report - ' + getTypeTitle(type), pageWidth / 2, yPos, { align: 'center' });
            yPos += 8;
            
            const date = new Date().toLocaleString();
            doc.setFontSize(10);
            doc.text(`Generated on: ${date} by ${currentUser.fullName} (${currentUser.username})`, pageWidth / 2, yPos, { align: 'center' });
            yPos += 15;
            
            // Get data for export
            let data = [];
            let headers = [];
            
            switch(type) {
                case 'task':
                    data = taskLogs;
                    headers = [['Island', 'Service Number', 'English Message', 'Dhivehi Message', 'Date']];
                    break;
                case 'operation':
                    data = operationLogs;
                    headers = [['Island', 'Service Number', 'English Message', 'Dhivehi Message', 'Date']];
                    break;
                case 'location':
                    data = locationLogs;
                    headers = [['Island', 'Location Name', 'Remarks', 'Date']];
                    break;
                case 'vehicle':
                    data = vehicles;
                    headers = [['Island', 'Type', 'Vehicle No.', 'Legal Owner', 'Beneficial Owner', 'Contact', 'Status']];
                    break;
                case 'shop':
                    data = shops;
                    headers = [['Island', 'Shop Name', 'Owner', 'Contact', 'Type', 'CCTV', 'Location']];
                    break;
                case 'boat':
                    data = boats;
                    headers = [['Island', 'Type', 'Vessel Name', 'Owner', 'Contact', 'Reg. Number', 'Capacity']];
                    break;
                case 'cctv':
                    data = cctvItems;
                    headers = [['Island', 'Location Type', 'Location Name', 'Area Name', 'Status', 'Installation Date']];
                    break;
                case 'monitoring':
                    data = monitoringItems;
                    headers = [['Type', 'Name', 'Owner', 'Contact', 'Island', 'Issue Type', 'Date Marked']];
                    break;
                case 'user':
                    if (!isAdmin) {
                        showToast('Only av_5637 can export users');
                        return;
                    }
                    data = users;
                    headers = [['Username', 'Full Name', 'Role', 'Status', 'Last Login']];
                    break;
                default:
                    showToast('Invalid export type');
                    return;
            }
            
            // Prepare table data
            let tableData = [];
            data.forEach(item => {
                switch(type) {
                    case 'task':
                        tableData.push([
                            item.island || '',
                            item.serviceNumber || '',
                            (item.messageEn || '').substring(0, 50) + (item.messageEn && item.messageEn.length > 50 ? '...' : ''),
                            (item.messageDv || '').substring(0, 50) + (item.messageDv && item.messageDv.length > 50 ? '...' : ''),
                            new Date(item.timestamp).toLocaleDateString()
                        ]);
                        break;
                    case 'operation':
                        tableData.push([
                            item.island || '',
                            item.serviceNumber || '',
                            (item.messageEn || '').substring(0, 50) + (item.messageEn && item.messageEn.length > 50 ? '...' : ''),
                            (item.messageDv || '').substring(0, 50) + (item.messageDv && item.messageDv.length > 50 ? '...' : ''),
                            new Date(item.timestamp).toLocaleDateString()
                        ]);
                        break;
                    case 'location':
                        tableData.push([
                            item.island || '',
                            item.locationName || '',
                            (item.remarks || '').substring(0, 50) + (item.remarks && item.remarks.length > 50 ? '...' : ''),
                            new Date(item.timestamp).toLocaleDateString()
                        ]);
                        break;
                    case 'vehicle':
                        const statusText = item.status === 'normal' ? 'Normal' : 
                                         item.status === 'traffic_issue' ? 'Traffic Violation' : 
                                         'Other Issue';
                        tableData.push([
                            item.island || '',
                            item.type || '',
                            item.number || '',
                            item.legalOwner || '',
                            item.beneficialOwner || '',
                            item.contact || '',
                            statusText
                        ]);
                        break;
                    case 'shop':
                        tableData.push([
                            item.island || '',
                            item.name || '',
                            item.owner || '',
                            item.contact || '',
                            item.description || '',
                            item.cctvAvailable ? 'Yes' : 'No',
                            item.location || ''
                        ]);
                        break;
                    case 'boat':
                        tableData.push([
                            item.island || '',
                            item.type || '',
                            item.name || '',
                            item.owner || '',
                            item.contact || '',
                            item.regNumber || '',
                            item.capacity ? `${item.capacity} persons` : ''
                        ]);
                        break;
                    case 'cctv':
                        tableData.push([
                            item.island || '',
                            item.locationType || '',
                            item.locationName || '',
                            item.areaName || '',
                            item.status ? item.status.charAt(0).toUpperCase() + item.status.slice(1) : '',
                            item.installationDate || 'Not set'
                        ]);
                        break;
                    case 'monitoring':
                        const issueText = item.issueType === 'traffic_issue' ? 'Traffic Violation' : 'Other Issue';
                        tableData.push([
                            item.type ? item.type.charAt(0).toUpperCase() + item.type.slice(1) : '',
                            item.name || '',
                            item.owner || '',
                            item.contact || '',
                            item.island || '',
                            issueText,
                            new Date(item.markedAt).toLocaleDateString()
                        ]);
                        break;
                    case 'user':
                        tableData.push([
                            item.username || '',
                            item.fullName || '',
                            item.role || '',
                            item.isActive ? 'Active' : 'Inactive',
                            item.lastLogin ? new Date(item.lastLogin).toLocaleDateString() : 'Never'
                        ]);
                        break;
                }
            });
            
            // Add table to PDF
            doc.autoTable({
                head: headers,
                body: tableData,
                startY: yPos,
                margin: { top: 10 },
                styles: { fontSize: 8 },
                headStyles: { fillColor: [41, 128, 185] },
                alternateRowStyles: { fillColor: [245, 245, 245] }
            });
            
            // Save PDF
            doc.save(`Faafu_Atoll_${getTypeTitle(type)}_Report_${new Date().toISOString().slice(0, 10)}.pdf`);
            
            showToast(`PDF exported successfully!`);
        }
        
        // Helper function to get type title
        function getTypeTitle(type) {
            switch(type) {
                case 'task': return 'Task Log';
                case 'operation': return 'Operation Log';
                case 'location': return 'Location Log';
                case 'vehicle': return 'Vehicles';
                case 'shop': return 'Shops';
                case 'boat': return 'Boats_Dinghy';
                case 'cctv': return 'CCTV_Cameras';
                case 'monitoring': return 'Monitoring';
                case 'user': return 'Users';
                default: return 'Report';
            }
        }
        
        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Setup language tabs for forms
        function setupLanguageTabs() {
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('language-tab')) {
                    const tab = e.target;
                    const lang = tab.getAttribute('data-lang');
                    const container = tab.closest('.form-group');
                    const tabs = container.querySelectorAll('.language-tab');
                    const messages = container.querySelectorAll('.message-container');
                    
                    // Update tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update message containers
                    messages.forEach(m => m.classList.remove('active'));
                    const activeMessage = container.querySelector(`#${tab.parentNode.parentNode.id} .message-container[data-lang="${lang}"], #${tab.parentNode.parentNode.id} .message-container[id*="${lang}"]`);
                    if (activeMessage) activeMessage.classList.add('active');
                }
            });
        }
        
        // Initialize language tabs
        setupLanguageTabs();
        
        // Add missing function to initialize language tabs in forms
        function initializeFormLanguageTabs() {
            // This function ensures language tabs work in all forms
            const forms = document.querySelectorAll('.entry-form, #edit-modal-content');
            forms.forEach(form => {
                const tabs = form.querySelectorAll('.language-tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const lang = this.getAttribute('data-lang');
                        const container = this.closest('.form-group');
                        const allTabs = container.querySelectorAll('.language-tab');
                        const allMessages = container.querySelectorAll('.message-container');
                        
                        allTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        allMessages.forEach(m => m.classList.remove('active'));
                        
                        const messageId = this.parentNode.parentNode.id;
                        const targetMessage = document.getElementById(`${messageId}-${lang}`);
                        if (targetMessage) targetMessage.classList.add('active');
                    });
                });
            });
        }
        
        // Call this after form creation
        setTimeout(initializeFormLanguageTabs, 1000);
        
        // Set up Enter key for login
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleLogin();
            }
        });
        
        // Handle enter key for all forms
        document.addEventListener('keypress', function(e) {
            if (e.target.tagName === 'INPUT' && e.key === 'Enter') {
                const form = e.target.closest('form');
                if (form) {
                    e.preventDefault();
                    form.dispatchEvent(new Event('submit'));
                }
            }
        });
        
        // Refresh monitoring button
        document.getElementById('refresh-monitoring').addEventListener('click', loadMonitoringItems);
        
        // Handle language tabs in edit forms when modal opens
        document.getElementById('edit-data-modal').addEventListener('shown', function() {
            setTimeout(initializeFormLanguageTabs, 100);
        });
        
        // Clean up when page is closed
        window.addEventListener('beforeunload', function() {
            if (timeInterval) clearInterval(timeInterval);
        });
        
        console.log('Island Log System v9.1 initialized successfully');
    </script>

    <script src="script.js"></script>
    <script>
        // Delete item (Add this function)
function deleteItem(type, id) {
    if (!isAdmin) {
        showToast('Only av_5637 can delete items');
        return;
    }
    
    currentDeleteItem = id;
    currentDataType = type;
    
    // Get item details for confirmation message
    let itemName = '';
    switch(type) {
        case 'task':
            const task = taskLogs.find(t => t.id === id);
            itemName = task ? `Task from ${task.island}` : 'Task';
            break;
        case 'operation':
            const operation = operationLogs.find(o => o.id === id);
            itemName = operation ? `Operation from ${operation.island}` : 'Operation';
            break;
        case 'location':
            const location = locationLogs.find(l => l.id === id);
            itemName = location ? `Location: ${location.locationName}` : 'Location';
            break;
        case 'vehicle':
            const vehicle = vehicles.find(v => v.id === id);
            itemName = vehicle ? `Vehicle: ${vehicle.number}` : 'Vehicle';
            break;
        case 'shop':
            const shop = shops.find(s => s.id === id);
            itemName = shop ? `Shop: ${shop.name}` : 'Shop';
            break;
        case 'boat':
            const boat = boats.find(b => b.id === id);
            itemName = boat ? `Vessel: ${boat.name}` : 'Vessel';
            break;
        case 'cctv':
            const cctv = cctvItems.find(c => c.id === id);
            itemName = cctv ? `CCTV: ${cctv.locationName}` : 'CCTV Camera';
            break;
        case 'user':
            itemName = `User: ${id}`;
            break;
        default:
            itemName = 'Item';
    }
    
    document.getElementById('delete-message').textContent = `Are you sure you want to delete "${itemName}"? This action cannot be undone.`;
    showModal(document.getElementById('delete-modal'));
}

// Fix exportToPDF function - replace it with this:
function exportToPDF(type) {
    try {
        if (typeof window.jspdf === 'undefined') {
            showToast('PDF library not loaded. Please wait or refresh the page.');
            return;
        }
        
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        const pageWidth = doc.internal.pageSize.getWidth();
        const margin = 10;
        let yPos = margin;
        
        // Header
        doc.setFontSize(16);
        doc.setFont('helvetica', 'bold');
        doc.text('Faafu Atoll Island Log System', pageWidth / 2, yPos, { align: 'center' });
        yPos += 8;
        
        doc.setFontSize(12);
        doc.setFont('helvetica', 'normal');
        doc.text('Official Report - ' + getTypeTitle(type), pageWidth / 2, yPos, { align: 'center' });
        yPos += 8;
        
        const date = new Date().toLocaleString();
        doc.setFontSize(10);
        doc.text(`Generated on: ${date} by ${currentUser.fullName} (${currentUser.username})`, pageWidth / 2, yPos, { align: 'center' });
        yPos += 15;
        
        // Get data for export
        let data = [];
        let headers = [];
        
        switch(type) {
            case 'task':
                data = taskLogs;
                headers = [['Island', 'Service Number', 'English Message', 'Date']];
                break;
            case 'operation':
                data = operationLogs;
                headers = [['Island', 'Service Number', 'English Message', 'Date']];
                break;
            case 'location':
                data = locationLogs;
                headers = [['Island', 'Location Name', 'Remarks', 'Date']];
                break;
            case 'vehicle':
                data = vehicles;
                headers = [['Island', 'Type', 'Vehicle No.', 'Legal Owner', 'Status']];
                break;
            case 'shop':
                data = shops;
                headers = [['Island', 'Shop Name', 'Owner', 'Type', 'CCTV']];
                break;
            case 'boat':
                data = boats;
                headers = [['Island', 'Type', 'Vessel Name', 'Owner', 'Reg. Number']];
                break;
            case 'cctv':
                data = cctvItems;
                headers = [['Island', 'Location Type', 'Location Name', 'Status']];
                break;
            case 'monitoring':
                data = monitoringItems;
                headers = [['Type', 'Name', 'Island', 'Issue Type', 'Date']];
                break;
            case 'user':
                if (!isAdmin) {
                    showToast('Only av_5637 can export users');
                    return;
                }
                data = users;
                headers = [['Username', 'Full Name', 'Role', 'Status']];
                break;
            default:
                showToast('Invalid export type');
                return;
        }
        
        // Prepare table data
        let tableData = [];
        data.forEach(item => {
            switch(type) {
                case 'task':
                    tableData.push([
                        item.island || '',
                        item.serviceNumber || '',
                        (item.messageEn || '').substring(0, 30) + (item.messageEn && item.messageEn.length > 30 ? '...' : ''),
                        new Date(item.timestamp).toLocaleDateString()
                    ]);
                    break;
                case 'operation':
                    tableData.push([
                        item.island || '',
                        item.serviceNumber || '',
                        (item.messageEn || '').substring(0, 30) + (item.messageEn && item.messageEn.length > 30 ? '...' : ''),
                        new Date(item.timestamp).toLocaleDateString()
                    ]);
                    break;
                case 'location':
                    tableData.push([
                        item.island || '',
                        item.locationName || '',
                        (item.remarks || '').substring(0, 30) + (item.remarks && item.remarks.length > 30 ? '...' : ''),
                        new Date(item.timestamp).toLocaleDateString()
                    ]);
                    break;
                case 'vehicle':
                    const statusText = item.status === 'normal' ? 'Normal' : 
                                     item.status === 'traffic_issue' ? 'Traffic Issue' : 
                                     'Other Issue';
                    tableData.push([
                        item.island || '',
                        item.type || '',
                        item.number || '',
                        item.legalOwner || '',
                        statusText
                    ]);
                    break;
                case 'shop':
                    tableData.push([
                        item.island || '',
                        item.name || '',
                        item.owner || '',
                        item.description || '',
                        item.cctvAvailable ? 'Yes' : 'No'
                    ]);
                    break;
                case 'boat':
                    tableData.push([
                        item.island || '',
                        item.type || '',
                        item.name || '',
                        item.owner || '',
                        item.regNumber || ''
                    ]);
                    break;
                case 'cctv':
                    tableData.push([
                        item.island || '',
                        item.locationType || '',
                        item.locationName || '',
                        item.status ? item.status.charAt(0).toUpperCase() + item.status.slice(1) : ''
                    ]);
                    break;
                case 'monitoring':
                    const issueText = item.issueType === 'traffic_issue' ? 'Traffic' : 'Other';
                    tableData.push([
                        item.type ? item.type.charAt(0).toUpperCase() + item.type.slice(1) : '',
                        item.name || '',
                        item.island || '',
                        issueText,
                        new Date(item.markedAt).toLocaleDateString()
                    ]);
                    break;
                case 'user':
                    tableData.push([
                        item.username || '',
                        item.fullName || '',
                        item.role || '',
                        item.isActive ? 'Active' : 'Inactive'
                    ]);
                    break;
            }
        });
        
        // Check if there's data to export
        if (tableData.length === 0) {
            showToast(`No data to export for ${getTypeTitle(type)}`);
            return;
        }
        
        // Add table to PDF
        doc.autoTable({
            head: headers,
            body: tableData,
            startY: yPos,
            margin: { top: 10 },
            styles: { fontSize: 9 },
            headStyles: { fillColor: [41, 128, 185] },
            alternateRowStyles: { fillColor: [245, 245, 245] },
            columnStyles: {
                0: { cellWidth: 25 },
                1: { cellWidth: 30 },
                2: { cellWidth: 40 },
                3: { cellWidth: 35 },
                4: { cellWidth: 25 }
            }
        });
        
        // Save PDF
        const filename = `Faafu_Atoll_${getTypeTitle(type)}_${new Date().toISOString().slice(0, 10)}.pdf`;
        doc.save(filename);
        
        showToast(`PDF exported successfully: ${filename}`);
        
    } catch (error) {
        console.error('PDF Export Error:', error);
        showToast('Error exporting PDF. Check console for details.');
    }
}

// Helper function to get type title
function getTypeTitle(type) {
    const titles = {
        'task': 'Task_Log',
        'operation': 'Operation_Log',
        'location': 'Location_Log',
        'vehicle': 'Vehicles',
        'shop': 'Shops',
        'boat': 'Boats_Dinghy',
        'cctv': 'CCTV_Cameras',
        'monitoring': 'Monitoring',
        'user': 'Users'
    };
    return titles[type] || 'Report';
}

    </script>
    
</body>
</html>
